import{r as p,u as _e,j as e,H as ge,a as M}from"./app--mOlotUF.js";import{A as fe,D as U,X as D,t as o}from"./app-layout-FdSMx8-Y.js";import{C as _,c as g,a as $,b as W,d as ve,e as Ne}from"./card-DrKRoRG0.js";import{S as b,a as y,b as w,c as k,d as c}from"./select-BKfzqQn2.js";import{L as n}from"./label-B542vbnv.js";import{I as m}from"./input-CBFD_EUp.js";import{T as be}from"./textarea-Er0b_N-4.js";import{B as h}from"./app-logo-icon-KWi9P-ev.js";import{B as P}from"./badge-DRhZ3UKT.js";import{S as I}from"./separator-jx-n0iwv.js";import{S as z}from"./switch-oTSsVE-Z.js";import{T as ye,a as we,b as H,c as G}from"./tabs-D4A_sf1C.js";import{C as ke}from"./chevron-left-ChBud6Zh.js";import{B as C}from"./bell-DOd2zolg.js";import{G as Ce}from"./grid-3x3-DPdNCXX6.js";import{C as R}from"./calendar-Td7JGGLc.js";import{M as Te}from"./mail-D8LYxzbn.js";import{M as Se}from"./message-square-tvEsQ9X-.js";import{P as X}from"./plus-BTB0St45.js";import{C as V}from"./circle-alert-D9EkYXFk.js";import{T as Ee}from"./test-tube-Ea_WmrOw.js";import{S as Fe}from"./save-BLxO0HaU.js";/* empty css            */import"./index-CyI_ZakN.js";import"./index-WelwWk4r.js";import"./index-BSgIEyps.js";import"./loader-circle-ddbBxRrc.js";import"./index-DqegC-a3.js";import"./check-BHptGlaC.js";function ds({observer:t,connections:O,selectedConnection:u,selectedTable:f,fields:T}){const[Ae,J]=p.useState(u?.id?.toString()||""),[S,K]=p.useState(f?.id?.toString()||""),[L,Q]=p.useState([]),[N,q]=p.useState(T||[]),[E,De]=p.useState(!1),[Z,ee]=p.useState(t.telegram_bot_token&&t.telegram_chat_ids?.length>0?"telegram":"email"),{data:a,setData:r,put:se,processing:v,errors:i}=_e({name:t.name||"",field_to_watch:t.field_to_watch||"",condition_type:t.condition_type||"less_than",threshold_value:t.threshold_value||"",string_value:t.string_value||"",date_field_type:t.date_field_type||"",days_before_alert:t.days_before_alert||"",days_after_alert:t.days_after_alert||"",alert_on_expired:t.alert_on_expired||!1,date_format:t.date_format||"",is_active:t.is_active??!0,notification_emails:t.notification_emails||[""],telegram_chat_ids:t.telegram_chat_ids||[""],telegram_bot_token:t.telegram_bot_token||"",notification_subject:t.notification_subject||"Database Alert: {observer_name}",notification_message:t.notification_message||'The condition "{condition}" has been met for field "{field}" in table "{table_name}". Current value: {current_value}',check_interval_minutes:t.check_interval_minutes||60});p.useEffect(()=>{if(u){J(u.id.toString());const s=O.find(l=>l.id===u.id);s?.tables&&Q(s.tables),K(f?.id?.toString()||""),q(T||[])}},[u,f,O,T]),p.useEffect(()=>{if(S){const s=L.find(l=>l.id.toString()===S);s?.fields&&q(s.fields)}},[S,L]);const ae=s=>{s.preventDefault();const l=a.notification_emails.filter(x=>x&&x.trim()!==""),d=a.telegram_chat_ids.filter(x=>x&&x.trim()!==""),j=l.length>0,A=d.length>0&&a.telegram_bot_token.trim()!=="";if(!j&&!A){o.error("Configuration Error",{description:"Please provide at least one notification method (email or Telegram)"});return}if(F(a.condition_type)&&!a.date_field_type){o.error("Configuration Error",{description:"Please select a date field type for date conditions"});return}const je={...a,notification_emails:l,telegram_chat_ids:d,telegram_bot_token:a.telegram_bot_token.trim()||null,threshold_value:a.threshold_value||null,string_value:a.string_value||null,days_before_alert:a.days_before_alert||null,days_after_alert:a.days_after_alert||null,date_format:a.date_format||null};se(`/value-observers/${t.id}`,je,{preserveScroll:!0,onSuccess:()=>{o.success("Value Observer Updated",{description:"Your observer has been updated successfully"})},onError:x=>{x.notification_method?o.error("Configuration Error",{description:x.notification_method}):o.error("Update Failed",{description:"Please check the form for errors"})}})},te=()=>{M.post(`/value-observers/${t.id}/test-notification`,{},{preserveScroll:!0,onSuccess:s=>{const l=s.props.results;let d="Test completed: ";if(l.email?.success&&(d+=`Email sent to ${l.email.recipients?.length||0} recipient(s). `),l.telegram?.success){const j=Object.values(l.telegram.results||{}).filter(A=>A.success).length;d+=`Telegram message sent to ${j} chat(s).`}o.success("Notification Test Complete",{description:d})},onError:()=>{o.error("Test Failed",{description:"Unable to test notifications"})}})},ie=()=>{M.post(`/value-observers/${t.id}/test`,{},{preserveScroll:!0,onSuccess:s=>{o.success("Test Completed",{description:`Checked ${s.props.total_records} records, ${s.props.condition_met_count} met the condition`})},onError:()=>{o.error("Test Failed",{description:"Unable to test the observer"})}})},le=()=>{r("notification_emails",[...a.notification_emails,""])},re=s=>{if(a.notification_emails.length>1){const l=a.notification_emails.filter((d,j)=>j!==s);r("notification_emails",l)}},ne=(s,l)=>{const d=[...a.notification_emails];d[s]=l,r("notification_emails",d)},de=()=>{r("telegram_chat_ids",[...a.telegram_chat_ids,""])},ce=s=>{if(a.telegram_chat_ids.length>1){const l=a.telegram_chat_ids.filter((d,j)=>j!==s);r("telegram_chat_ids",l)}},oe=(s,l)=>{const d=[...a.telegram_chat_ids];d[s]=l,r("telegram_chat_ids",d)},me=[{value:"less_than",label:"Less than",description:"Value is less than threshold"},{value:"greater_than",label:"Greater than",description:"Value is greater than threshold"},{value:"equals",label:"Equals",description:"Value equals threshold"},{value:"not_equals",label:"Not equals",description:"Value does not equal threshold"},{value:"contains",label:"Contains",description:"Value contains text"},{value:"starts_with",label:"Starts with",description:"Value starts with text"},{value:"ends_with",label:"Ends with",description:"Value ends with text"},{value:"date_near_expiry",label:"Near expiration date",description:"Alert when date is nearing expiry"},{value:"date_expired",label:"Expired",description:"Alert when date is expired"},{value:"date_future",label:"Future date",description:"Alert when date is in future"},{value:"date_past",label:"Past date",description:"Alert when date is in past"}],he=[{value:"date",label:"Date (YYYY-MM-DD)"},{value:"datetime",label:"Date & Time"},{value:"timestamp",label:"Timestamp"}],F=s=>s?.includes("date_"),xe=()=>{switch(a.condition_type){case"less_than":case"greater_than":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"threshold_value",children:"Threshold Value"}),e.jsx(m,{id:"threshold_value",type:"number",step:"any",value:a.threshold_value||"",onChange:s=>r("threshold_value",s.target.value||null),placeholder:"Enter threshold value"}),i.threshold_value&&e.jsx("p",{className:"text-sm text-red-600",children:i.threshold_value})]});case"equals":case"not_equals":case"contains":case"starts_with":case"ends_with":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"string_value",children:"Text Value"}),e.jsx(m,{id:"string_value",value:a.string_value||"",onChange:s=>r("string_value",s.target.value||null),placeholder:"Enter text to compare"}),i.string_value&&e.jsx("p",{className:"text-sm text-red-600",children:i.string_value})]});case"date_near_expiry":case"date_expired":case"date_future":case"date_past":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"date_field_type",children:"Date Field Type *"}),e.jsxs(b,{value:a.date_field_type||"",onValueChange:s=>r("date_field_type",s),required:F(a.condition_type),children:[e.jsx(y,{children:e.jsx(w,{placeholder:"Select date type"})}),e.jsx(k,{children:he.map(s=>e.jsx(c,{value:s.value,children:s.label},s.value))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Type of date field in your database"}),i.date_field_type&&e.jsx("p",{className:"text-sm text-red-600",children:i.date_field_type})]}),a.condition_type==="date_near_expiry"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"days_before_alert",children:"Alert Before Days"}),e.jsx(m,{id:"days_before_alert",type:"number",min:"1",max:"365",value:a.days_before_alert||"",onChange:s=>r("days_before_alert",s.target.value),placeholder:"e.g., 7 (alert 7 days before expiry)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Send alert when date is within this many days of expiry"}),i.days_before_alert&&e.jsx("p",{className:"text-sm text-red-600",children:i.days_before_alert})]}),a.condition_type==="date_expired"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Alert Options"}),e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[e.jsx(z,{id:"alert_on_expired",checked:a.alert_on_expired||!1,onCheckedChange:s=>r("alert_on_expired",s)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{htmlFor:"alert_on_expired",className:"font-medium",children:"Alert on expired dates"}),e.jsx("p",{className:"text-xs text-gray-500",children:"When disabled, alerts when date is NOT expired"})]})]}),i.alert_on_expired&&e.jsx("p",{className:"text-sm text-red-600",children:i.alert_on_expired})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"date_format",children:"Date Format (Optional)"}),e.jsx(m,{id:"date_format",value:a.date_format||"",onChange:s=>r("date_format",s.target.value),placeholder:"e.g., Y-m-d, Y-m-d H:i:s, d/m/Y"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Leave empty for auto-detection. Common formats: Y-m-d, Y-m-d H:i:s, d/m/Y, m/d/Y"}),i.date_format&&e.jsx("p",{className:"text-sm text-red-600",children:i.date_format})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 dark:text-blue-300 mb-2",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Date Alert Preview"})]}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[a.condition_type==="date_near_expiry"&&`Will alert when date is within ${a.days_before_alert||7} days of expiry`,a.condition_type==="date_expired"&&`Will alert when date is ${a.alert_on_expired?"expired":"not expired"}`,a.condition_type==="date_future"&&"Will alert when date is in the future",a.condition_type==="date_past"&&"Will alert when date is in the past"]})]})]});default:return null}},pe=()=>t.is_active?e.jsx(P,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Active"}):e.jsx(P,{variant:"outline",className:"bg-gray-50 dark:bg-black text-gray-700 border-gray-200",children:"Inactive"}),ue=()=>t.last_checked_at?new Date(t.last_checked_at).toLocaleString():"Never",B=()=>t.telegram_bot_token&&t.telegram_chat_ids?.length>0,Y=F(a.condition_type);return e.jsxs(fe,{children:[e.jsx(ge,{title:`Edit ${t.name}`}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Edit Value Observer"}),pe()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update your monitoring configuration"})]})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(_,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.trigger_count}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Alerts Triggered"})]})}),e.jsx(_,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.last_checked_at?"âœ“":"â€”"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last checked: ",ue()]})]})}),e.jsx(_,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.last_triggered_at?"âš ï¸":"âœ“"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.last_triggered_at?`Last alert: ${new Date(t.last_triggered_at).toLocaleString()}`:"No alerts triggered"})]})}),e.jsx(_,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:B()?"âœ“":"â€”"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Telegram ",B()?"Enabled":"Disabled"]})]})})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs(_,{children:[e.jsxs($,{children:[e.jsx(W,{children:"Observer Configuration"}),e.jsx(ve,{children:"Update what to monitor and when to alert"})]}),e.jsx(g,{children:e.jsxs("form",{onSubmit:ae,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Database & Table"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Database Connection"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 dark:bg-black",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:u?.name})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cannot be changed after creation"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Table"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 dark:bg-black",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:f?.name})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cannot be changed after creation"})]})]})]})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"What to Watch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Observer Name"}),e.jsx(m,{id:"name",value:a.name,onChange:s=>r("name",s.target.value),placeholder:"e.g., Low Stock Alert",required:!0}),i.name&&e.jsx("p",{className:"text-sm text-red-600",children:i.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"field_to_watch",children:"Field to Watch"}),e.jsxs(b,{value:a.field_to_watch,onValueChange:s=>r("field_to_watch",s),disabled:E||N.length===0,children:[e.jsx(y,{children:E?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"}),"Loading fields..."]}):e.jsx(w,{placeholder:N.length===0?"No fields available":"Select a field"})}),e.jsx(k,{children:N.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(c,{value:s,children:s},s))})]}),N.length===0&&!E&&e.jsx("p",{className:"text-sm text-yellow-600",children:"No fields found for this table"}),i.field_to_watch&&e.jsx("p",{className:"text-sm text-red-600",children:i.field_to_watch})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"condition_type",children:"Condition Type"}),e.jsxs(b,{value:a.condition_type,onValueChange:s=>r("condition_type",s),children:[e.jsx(y,{children:e.jsx(w,{placeholder:"Select condition type"})}),e.jsx(k,{children:me.map(s=>e.jsx(c,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]}),i.condition_type&&e.jsx("p",{className:"text-sm text-red-600",children:i.condition_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Condition Value"}),xe()]})]}),Y&&e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800 dark:text-green-300",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("p",{className:"font-medium",children:"Date Monitoring Active"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:"This observer will monitor date values. Make sure your database field contains valid date values."})]})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Notification Settings"]}),e.jsxs(ye,{value:Z,onValueChange:ee,children:[e.jsxs(we,{className:"grid grid-cols-2 mb-6",children:[e.jsxs(H,{value:"email",className:"gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),"Email Notifications"]}),e.jsxs(H,{value:"telegram",className:"gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Telegram Notifications"]})]}),e.jsxs(G,{value:"email",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Email Recipients"}),e.jsx("div",{className:"space-y-3 mt-2",children:a.notification_emails.map((s,l)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"email",value:s,onChange:d=>ne(l,d.target.value),placeholder:"email@example.com"}),a.notification_emails.length>1&&e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>re(l),children:e.jsx(D,{className:"w-4 h-4"})})]},l))}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:le,className:"mt-2",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Add Another Email"]}),i.notification_emails&&e.jsx("p",{className:"text-sm text-red-600",children:i.notification_emails})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_subject",children:"Email Subject"}),e.jsx(m,{id:"notification_subject",value:a.notification_subject,onChange:s=>r("notification_subject",s.target.value),placeholder:"Alert: {observer_name}",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}"]}),i.notification_subject&&e.jsx("p",{className:"text-sm text-red-600",children:i.notification_subject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_message",children:"Email Message"}),e.jsx(be,{id:"notification_message",value:a.notification_message,onChange:s=>r("notification_message",s.target.value),rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}",", ","{current_value}",", ","{record_id}"]}),i.notification_message&&e.jsx("p",{className:"text-sm text-red-600",children:i.notification_message})]})]}),e.jsxs(G,{value:"telegram",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"telegram_bot_token",children:"Telegram Bot Token"}),e.jsx(m,{id:"telegram_bot_token",type:"password",value:a.telegram_bot_token,onChange:s=>r("telegram_bot_token",s.target.value),placeholder:"1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get your bot token from @BotFather on Telegram"}),i.telegram_bot_token&&e.jsx("p",{className:"text-sm text-red-600",children:i.telegram_bot_token})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Telegram Chat IDs"}),e.jsx("div",{className:"space-y-3 mt-2",children:a.telegram_chat_ids.map((s,l)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{value:s,onChange:d=>oe(l,d.target.value),placeholder:"123456789"}),a.telegram_chat_ids.length>1&&e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>ce(l),children:e.jsx(D,{className:"w-4 h-4"})})]},l))}),e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:de,className:"mt-2",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Add Another Chat ID"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Users need to start a chat with your bot first, then share their chat ID"}),i.telegram_chat_ids&&e.jsx("p",{className:"text-sm text-red-600",children:i.telegram_chat_ids})]}),e.jsx(_,{className:"dark:bg-black bg-blue-50 border-blue-200",children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h4",{className:"font-semibold dark:text-white text-blue-800 mb-2",children:"Telegram Message Preview"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-white mb-2",children:"Alerts will be sent in this format:"}),e.jsxs("div",{className:"text-sm dark:bg-black bg-white p-3 rounded border",children:[e.jsxs("p",{children:["âš ï¸ ",e.jsx("strong",{children:"Database Value Alert"})]}),e.jsxs("p",{children:["ðŸ” ",e.jsx("strong",{children:"Observer:"})," ",a.name||"Observer Name"]}),e.jsxs("p",{children:["ðŸ“Š ",e.jsx("strong",{children:"Table:"})," ",f?.name||"Table Name"]}),e.jsxs("p",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Field:"})," ",a.field_to_watch||"field_name"]}),e.jsxs("p",{children:["ðŸ“ ",e.jsx("strong",{children:"Condition:"})," ",a.condition_type?.replace("_"," ")," ",a.threshold_value||a.string_value]}),Y&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["ðŸ“… ",e.jsx("strong",{children:"Date Type:"})," ",a.date_field_type||"Not specified"]}),a.days_before_alert&&e.jsxs("p",{children:["â³ ",e.jsx("strong",{children:"Alert Before:"})," ",a.days_before_alert," days"]})]}),e.jsxs("p",{children:["ðŸ“ˆ ",e.jsx("strong",{children:"Current Value:"})," [value]"]})]})]})})]})]}),i.notification_method&&e.jsxs("div",{className:"rounded-lg bg-red-50 border border-red-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("p",{className:"text-sm font-medium",children:"Notification Error"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.notification_method})]}),e.jsxs("div",{className:"rounded-lg bg-yellow-50 border border-yellow-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("p",{className:"text-sm font-medium",children:"Notification Method"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"You can configure both email and Telegram notifications, or just one. At least one notification method is required."})]})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 4: Schedule & Activation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"check_interval_minutes",children:"Check Interval (minutes)"}),e.jsxs(b,{value:a.check_interval_minutes.toString(),onValueChange:s=>r("check_interval_minutes",parseInt(s)),children:[e.jsx(y,{children:e.jsx(w,{})}),e.jsxs(k,{children:[e.jsx(c,{value:"1",children:"Every minute"}),e.jsx(c,{value:"2",children:"Every 2 minutes"}),e.jsx(c,{value:"3",children:"Every 3 minutes"}),e.jsx(c,{value:"15",children:"Every 15 minutes"}),e.jsx(c,{value:"30",children:"Every 30 minutes"}),e.jsx(c,{value:"60",children:"Every hour"}),e.jsx(c,{value:"180",children:"Every 3 hours"}),e.jsx(c,{value:"360",children:"Every 6 hours"}),e.jsx(c,{value:"720",children:"Every 12 hours"}),e.jsx(c,{value:"1440",children:"Every day"})]})]}),i.check_interval_minutes&&e.jsx("p",{className:"text-sm text-red-600",children:i.check_interval_minutes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"is_active",children:"Observer Status"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Active"}),e.jsx("div",{className:"text-sm text-gray-500",children:a.is_active?"Observer is active and will check":"Observer is paused"})]}),e.jsx(z,{checked:a.is_active,onCheckedChange:s=>r("is_active",s)})]}),i.is_active&&e.jsx("p",{className:"text-sm text-red-600",children:i.is_active})]})]})]}),e.jsx(Ne,{className:"px-0 pb-0 pt-6",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{type:"button",variant:"outline",onClick:()=>window.history.back(),disabled:v,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(h,{type:"button",variant:"outline",onClick:ie,disabled:v,className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Test Observer"]}),e.jsxs(h,{type:"button",variant:"outline",onClick:te,disabled:v,className:"gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Test Notification"]})]}),e.jsx(h,{type:"submit",disabled:v,className:"gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-4 h-4"}),"Save Changes"]})})]})})]})})]}),e.jsxs(_,{className:"mt-6",children:[e.jsx($,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Observer Information"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Current Configuration"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Updated:"}),e.jsx("span",{children:new Date(t.updated_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Database:"}),e.jsx("span",{children:u?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Table:"}),e.jsx("span",{children:f?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Field to Watch:"}),e.jsx("span",{children:t.field_to_watch})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Condition:"}),e.jsx("span",{children:t.condition_type?.replace("_"," ")})]}),t.date_field_type&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date Field Type:"}),e.jsx("span",{children:t.date_field_type})]}),t.days_before_alert&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Alert Before Days:"}),e.jsx("span",{children:t.days_before_alert})]}),t.alert_on_expired!==null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Alert on Expired:"}),e.jsx("span",{children:t.alert_on_expired?"Yes":"No"})]}),t.date_format&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Date Format:"}),e.jsx("span",{children:t.date_format})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Check Interval:"}),e.jsxs("span",{children:["Every ",t.check_interval_minutes," minutes"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Email Notifications:"}),e.jsxs("span",{children:[t.notification_emails?.length||0," recipient(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Telegram Notifications:"}),e.jsxs("span",{children:[t.telegram_chat_ids?.length||0," chat(s)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Telegram Bot:"}),e.jsx("span",{children:t.telegram_bot_token?"Configured":"Not configured"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Testing"}),e.jsx("p",{className:"text-sm text-gray-600",children:'Use the "Test Observer" button to immediately check the current observer configuration against up to 10 records. Use the "Test Notification" button to send test notifications to all configured channels.'})]})]})})]})]})]})]})}export{ds as default};
