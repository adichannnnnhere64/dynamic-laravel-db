import{j as e,H as _,L as o,a as j}from"./app-DGXHZrET.js";import{A as y,R as v,D as w}from"./app-layout-Dql5IVxS.js";import{C as i,a as n,b as l,d as b,c}from"./card-Cv8tL66e.js";import{B as d}from"./badge-CoxKmixK.js";import{B as r}from"./app-logo-icon-7BszVvf1.js";import{C}from"./chevron-left-DYaWPLKH.js";import{B as k}from"./bell-COGtJX83.js";import{C as m}from"./calendar-UrKik5Ta.js";import{S as D}from"./square-pen-DlDsFk3-.js";import{C as T}from"./clock-hr81igq-.js";import{M as p}from"./mail-DMr3mBLC.js";import{M as A}from"./message-square-COnAHpUs.js";import{C as L}from"./circle-alert-BCNKFD3J.js";import{T as S}from"./trash-2-BuaiP1xy.js";/* empty css            */import"./index-Bvj2GysQ.js";import"./index-Bb28m5l8.js";import"./index-B3m84JAj.js";import"./loader-circle-Cxhx236L.js";function K({observer:s}){const h=a=>a?new Date(a).toLocaleString():"Never",g=()=>{const t={less_than:"Less than",greater_than:"Greater than",equals:"Equals",not_equals:"Not equals",contains:"Contains",starts_with:"Starts with",ends_with:"Ends with",date_near_expiry:"Near expiration date",date_expired:"Expired",date_future:"Future date",date_past:"Past date"}[s.condition_type]||s.condition_type;return s.threshold_value!==null?`${t} ${s.threshold_value}`:s.string_value?`${t} "${s.string_value}"`:s.condition_type==="date_near_expiry"&&s.days_before_alert?`Expires within ${s.days_before_alert} days`:s.condition_type==="date_expired"?`Date ${s.alert_on_expired?"expired":"not expired"}`:t},N=()=>{confirm("Test this observer now? This will check current values immediately.")&&j.post(`/value-observers/${s.id}/test`)},u=s.telegram_bot_token&&s.telegram_chat_ids?.length>0;s.notification_emails?.length>0;const x=s.condition_type?.includes("date_"),f=()=>x?e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2 flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),"Date Monitoring Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date Field Type:"}),e.jsx("span",{className:"font-medium",children:s.date_field_type||"Not specified"})]}),s.days_before_alert&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Alert Before Days:"}),e.jsxs("span",{className:"font-medium",children:[s.days_before_alert," days"]})]}),s.days_after_alert&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Alert After Days:"}),e.jsxs("span",{className:"font-medium",children:[s.days_after_alert," days"]})]}),s.alert_on_expired!==null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Alert on Expired:"}),e.jsx("span",{className:"font-medium",children:s.alert_on_expired?"Yes":"No"})]}),s.date_format&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date Format:"}),e.jsx("span",{className:"font-mono",children:s.date_format})]})]})]}):null;return e.jsxs(y,{children:[e.jsx(_,{title:s.name}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(k,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(d,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Triggers: ",s.trigger_count]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Last check: ",h(s.last_checked_at)]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs(d,{variant:"outline",className:"border-blue-200 text-blue-700",children:[e.jsx(m,{className:"w-3 h-3 mr-1"}),"Date Monitor"]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(r,{variant:"outline",onClick:N,className:"gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Test Now"]}),e.jsx(r,{variant:"outline",asChild:!0,children:e.jsxs(o,{href:`/value-observers/${s.id}/edit`,className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Edit"]})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Observer Configuration"}),e.jsx(b,{children:"What this observer is monitoring"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Database Connection"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(w,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.connection_table.connection.name})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.connection_table.connection.database," @",s.connection_table.connection.host,":",s.connection_table.connection.port]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Table"}),e.jsx("p",{className:"font-medium mt-1",children:s.connection_table.name}),e.jsx("code",{className:"text-sm text-gray-600",children:s.connection_table.table_name})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Field Being Watched"}),e.jsx(d,{variant:"outline",className:"mt-1",children:s.field_to_watch})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Condition"}),e.jsx(d,{className:"mt-1 bg-blue-100 text-blue-800",children:g()})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Check Interval"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Every ",s.check_interval_minutes," minutes"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Last Trigger"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:h(s.last_triggered_at)})]})]})]})]}),f()]})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"Notification Settings"]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Email Recipients"}),e.jsx("div",{className:"space-y-1",children:s.notification_emails.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Email Subject"}),e.jsx("p",{className:"font-mono text-sm bg-gray-50 dark:bg-black p-2 rounded",children:s.notification_subject})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Email Message"}),e.jsx("div",{className:"font-mono text-sm bg-gray-50 dark:bg-black p-3 rounded whitespace-pre-wrap",children:s.notification_message})]})]}),s.telegram_bot_token&&s.telegram_chat_ids?.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Telegram Notifications"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Bot token configured"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Chat IDs:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.telegram_chat_ids.map((a,t)=>e.jsx(d,{variant:"outline",className:"text-xs",children:a},t))})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(l,{children:"Statistics"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.trigger_count}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Triggers"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold",children:s.logs.filter(a=>a.condition_met).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Conditions Met"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold",children:s.logs.filter(a=>a.notification_sent_to).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Notifications Sent"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Last Updated"}),e.jsx("span",{children:new Date(s.updated_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Date Monitoring"}),e.jsx("span",{children:x?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Telegram"}),e.jsx("span",{children:u?"Enabled":"Disabled"})]})]})})]})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(l,{children:"Recent Activity"})}),e.jsxs(c,{children:[s.logs.length>0?e.jsx("div",{className:"space-y-3",children:s.logs.slice(0,5).map(a=>e.jsxs("div",{className:`p-3 rounded border ${a.condition_met?"bg-red-50 dark:text-black border-red-200":"bg-gray-50 dark:bg-black border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.condition_met?e.jsx(L,{className:"w-4 h-4 text-red-600"}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-300"}),e.jsxs("span",{className:"text-sm font-medium",children:["Record ",a.record_id]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"mt-2 text-sm",children:x&&a.current_date_value?e.jsxs("div",{children:[e.jsxs("div",{children:["Date: ",new Date(a.current_date_value).toLocaleString()]}),s.condition_type==="date_near_expiry"&&a.condition_met&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"⚠️ Near expiry"})]}):e.jsxs("div",{children:["Value: ",a.current_value||a.current_string_value||"N/A"]})})]},a.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No activity yet"}),s.logs.length>5&&e.jsx(r,{variant:"ghost",size:"sm",className:"w-full mt-3",asChild:!0,children:e.jsx(o,{href:`/value-observers/${s.id}/logs`,children:"View All Activity"})})]})]}),e.jsxs(i,{className:"border-red-200",children:[e.jsx(n,{children:e.jsx(l,{className:"text-red-700",children:"Danger Zone"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(r,{variant:"destructive",className:"w-full gap-2",onClick:()=>{confirm("Are you sure you want to delete this observer? This action cannot be undone.")&&j.delete(`/value-observers/${s.id}`)},children:[e.jsx(S,{className:"w-4 h-4"}),"Delete Observer"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Deleting this observer will remove all configuration and logs."})]})})]})]})]})})]})]})}export{K as default};
