import{r as c,u as L,a as q,j as e,L as I}from"./app-DeAqZtZ3.js";import{A as B}from"./app-layout-DgaGjPfW.js";import{C as v,a as _,b as T,c as C}from"./card-kVUHXLHN.js";import{I as k}from"./input-El65ufWx.js";import{L as j}from"./label-q7ELVbuS.js";import{B as p}from"./app-logo-icon-B8fPI5Uv.js";import{T as H,a as K,b as S,c as d,d as R,e as n}from"./table-CCH9otKR.js";import{P as z}from"./plus-NO3iVm8d.js";import{S as M}from"./square-pen-CA9WN33R.js";import{E as V}from"./eye-D3Y--fXN.js";/* empty css            */import"./index-BJC1wku9.js";import"./index-CHvhUF_F.js";import"./index-CSpiwRm-.js";function ie({connection:r,actualTables:w}){const[b,m]=c.useState(!1),[x,o]=c.useState(""),[f,E]=c.useState([]),[y,h]=c.useState(null),{data:l,setData:i,post:D,processing:g,errors:t,reset:N}=L({table_name:"",name:"",primary_key:"id",fields:[],editable_fields:[],input_types:{}});c.useEffect(()=>{x&&q.get(`/api/connection/${r.id}/tables/${x}/columns`,{},{preserveState:!0,onSuccess:s=>{E(s.props.columns||[]),i("fields",s.props.columns||[]);const a=s.props.columns.filter(u=>u!==l.primary_key);i("editable_fields",a)}})},[x]);const P=s=>{s.preventDefault(),D(`/connect/${r.id}/tables`,{preserveScroll:!0,onSuccess:()=>{N(),m(!1),o(""),h(null)}})},A=s=>{h(s),m(!0),o(s.table_name),i({table_name:s.table_name,name:s.name,primary_key:s.primary_key,fields:s.fields,editable_fields:s.editable_fields||[],input_types:s.input_types||{}})},F=s=>{const a=l.editable_fields.includes(s)?l.editable_fields.filter(u=>u!==s):[...l.editable_fields,s];i("editable_fields",a)},$=(s,a)=>{i("input_types",{...l.input_types,[s]:a})};return e.jsx(B,{children:e.jsxs("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Manage Tables: ",r.name]}),e.jsxs("p",{className:"text-gray-600",children:[r.database," @ ",r.host]})]}),e.jsxs(p,{onClick:()=>m(!b),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Table"]})]}),b&&e.jsxs(v,{className:"mb-8",children:[e.jsx(_,{children:e.jsx(T,{children:y?`Edit Table: ${y.name}`:"Add New Table"})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Select Database Table *"}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:x,onChange:s=>o(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Select a table --"}),w.map(s=>e.jsx("option",{value:s,children:s},s))]}),t.table_name&&e.jsx("p",{className:"text-red-500 text-sm",children:t.table_name})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Display Name *"}),e.jsx(k,{value:l.name,onChange:s=>i("name",s.target.value),placeholder:"e.g., Products Inventory",required:!0}),t.name&&e.jsx("p",{className:"text-red-500 text-sm",children:t.name})]}),e.jsxs("div",{children:[e.jsx(j,{children:"Primary Key *"}),e.jsx(k,{value:l.primary_key,onChange:s=>i("primary_key",s.target.value),placeholder:"id",required:!0}),t.primary_key&&e.jsx("p",{className:"text-red-500 text-sm",children:t.primary_key})]})]}),f.length>0&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Table Fields Configuration"}),e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:s}),s===l.primary_key&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Primary Key"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.editable_fields.includes(s),onChange:()=>F(s),disabled:s===l.primary_key}),e.jsx("span",{className:"text-sm",children:"Editable"})]}),l.editable_fields.includes(s)&&e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:l.input_types[s]||"text",onChange:a=>$(s,a.target.value),children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"textarea",children:"Text Area"})]})]})]},s))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"submit",disabled:g,children:g?"Saving...":"Save Table Configuration"}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>{m(!1),N(),h(null)},children:"Cancel"})]})]})})]}),e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(T,{children:"Configured Tables"})}),e.jsx(C,{children:r.tables&&r.tables.length>0?e.jsxs(H,{children:[e.jsx(K,{children:e.jsxs(S,{children:[e.jsx(d,{children:"Display Name"}),e.jsx(d,{children:"Table Name"}),e.jsx(d,{children:"Primary Key"}),e.jsx(d,{children:"Fields"}),e.jsx(d,{children:"Editable Fields"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(R,{children:r.tables.map(s=>e.jsxs(S,{children:[e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{children:s.table_name}),e.jsx(n,{children:s.primary_key}),e.jsx(n,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.fields.map(a=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:a},a))})}),e.jsx(n,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(s.editable_fields||[]).map(a=>e.jsx("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:a},a))})}),e.jsx(n,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>A(s),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Edit"]}),e.jsxs(I,{href:`/product?conn=${r.id}&table=${s.id}`,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"View Data"]})]})})]},s.id))})]}):e.jsx("p",{className:"text-gray-500",children:"No tables configured yet."})})]})]})})}export{ie as default};
