import{r as p,j as e,H as te,L as ne,a as h}from"./app-AyFvkLHt.js";import{C as E,a as ce,b as ie,d as de,c as _}from"./card-DNNRQXi0.js";import{T as oe,a as xe,b as v,c as S,d as he,e as b,S as $}from"./table-B98rsF49.js";import{I as me}from"./input-C_JYf3hS.js";import{c as J,B as i}from"./app-logo-icon-BK4IrVPS.js";import{S as I,a as B,b as P,c as T,d as H}from"./select-lit_ok_P.js";import{B as y}from"./badge-DoPJFvVb.js";import{A as je,D as pe,b as ue,d as ge,e as fe,f as D,g as Ne}from"./app-layout-PBchuoGo.js";import{D as L,a as V,b as z,c as Q,d as q,e as G}from"./dialog-CUvgz1DT.js";import{T as k,S as we,A as O,a as X,b as be,c as ye,d as ve,e as Se,f as De,g as ke,h as Ce}from"./alert-dialog-Ds2lKRAk.js";import{C as Ae,G as C,D as A,t as u}from"./index-BBHJi-10.js";import{R as Me}from"./refresh-cw-CaQpniRf.js";import{P as Z}from"./plus-DTBZiQy2.js";import{C as Re}from"./copy-NRWEbvqu.js";/* empty css            */import"./index-fdDaLK-D.js";import"./index-R3WdzqYN.js";import"./index-DQM44TCQ.js";import"./check-BBWKwXqn.js";import"./index-CSpiwRm-.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],_e=J("EllipsisVertical",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Ie=J("QrCode",$e),Be=({onScan:t,onError:g,active:a})=>{const r=p.useRef(null),d=p.useRef(null);return p.useEffect(()=>{let l=!0;return(async()=>{try{if(!window.ZXing){const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/@zxing/library@latest/umd/index.min.js",document.head.appendChild(o),await new Promise((x,m)=>{o.onload=x,o.onerror=m})}if(!l||!r.current)return;const{BrowserMultiFormatReader:N}=window.ZXing;if(d.current=new N,a){const o=await d.current.listVideoInputDevices();let x=o[0]?.deviceId;const m=o.find(j=>j.label.toLowerCase().includes("back")||j.label.toLowerCase().includes("environment"));m&&(x=m.deviceId),await d.current.decodeFromVideoDevice(x,r.current,(j,n)=>{j&&t(j.getText()),n&&n.name!=="NotFoundException"&&g(n)})}}catch(N){g(N)}})(),()=>{l=!1,d.current&&d.current.reset()}},[a,t,g]),e.jsx("video",{ref:r,className:"w-full h-full object-cover",playsInline:!0,muted:!0})};function ls({products:t,connections:g,activeConnection:a,activeTable:r,fields:d,idField:l,editableFields:M,inputTypes:N}){const[o,x]=p.useState(!1),[m,j]=p.useState(""),[n,w]=p.useState([]),[Pe,Te]=p.useState(!1),[K,U]=p.useState(!1),W=s=>{h.get("/product",{conn:s,table:g.find(c=>c.id.toString()===s)?.tables?.[0]?.id||null},{preserveState:!0})},Y=s=>{h.get("/product",{conn:a.id,table:s},{preserveState:!0})},F=s=>{j(s),h.get("/product",{search:s,conn:a.id,table:r.id},{preserveState:!0}),x(!1),u.success("Scanned successfully",{description:`Searching for: ${s}`})},R=s=>{h.post("/product/search",{table_id:r.id,connection_id:a.id,[l]:s[l]})},ee=s=>{const c=s[l];h.delete("/product/delete",{data:{table_id:r.id,connection_id:a.id,[l]:c},onSuccess:()=>{u.success("Product deleted",{description:`${l}: ${c} has been removed`})}})},se=()=>{if(n.length===0){u.error("No items selected");return}confirm(`Delete ${n.length} selected items?`)&&(h.delete("/product/bulk-delete",{data:{table_id:r.id,connection_id:a.id,rows:n}}),w([]),u.success("Bulk deletion completed",{description:`${n.length} items deleted`}))},ae=s=>{w(c=>c.includes(s)?c.filter(f=>f!==s):[...c,s])},re=()=>{n.length===t.data.length?w([]):w(t.data.map(s=>s[l]))},le=()=>{h.reload({preserveScroll:!0,preserveState:!0,onSuccess:()=>{u.success("Data refreshed")}})};return e.jsxs(je,{children:[e.jsx(te,{title:`${r.name} - Products`}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"border-b bg-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(C,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r.name}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),a.name]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.table_name}),e.jsx("span",{children:"•"}),e.jsxs(y,{variant:"outline",className:"text-xs",children:[t.data.length," records"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(I,{value:a.id.toString(),onValueChange:W,children:[e.jsx(B,{className:"w-48",children:e.jsx(P,{children:a.name})}),e.jsx(T,{children:g.map(s=>e.jsx(H,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),s.name]})},s.id))})]}),e.jsxs(I,{value:r.id.toString(),onValueChange:Y,children:[e.jsx(B,{className:"w-48",children:e.jsx(P,{children:r.name})}),e.jsx(T,{children:a.tables.map(s=>e.jsx(H,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),s.name]})},s.id))})]}),e.jsxs(i,{variant:"outline",onClick:le,className:"gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Refresh"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(E,{className:"mb-6",children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Product Records"}),e.jsxs(de,{children:["Manage ",r.name," table in ",a.database]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n.length>0&&e.jsxs(i,{variant:"destructive",size:"sm",onClick:se,className:"gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Delete Selected (",n.length,")"]}),e.jsxs(L,{open:o,onOpenChange:x,children:[e.jsx(V,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Scan QR"]})}),e.jsxs(z,{className:"max-w-2xl",children:[e.jsxs(Q,{children:[e.jsx(q,{children:"Scan QR/Barcode"}),e.jsx(G,{children:"Point your camera at a QR code or barcode to scan"})]}),e.jsx("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:e.jsx(Be,{onScan:F,onError:s=>{u.error("Scanner Error",{description:s.message}),x(!1)},active:o})}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Scanned value: ",m]}),e.jsx(i,{onClick:()=>x(!1),children:"Close"})]})]})]}),e.jsx(i,{asChild:!0,children:e.jsxs(ne,{href:`/product/create?conn=${a.id}&table=${r.id}`,className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Add New"]})})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(me,{placeholder:`Search in ${d.join(", ")}`,value:m,onChange:s=>{j(s.target.value),h.get("/product",{search:s.target.value,conn:a.id,table:r.id},{preserveState:!0})},className:"pl-10"})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{open:K,onOpenChange:U,children:[e.jsx(V,{asChild:!0}),e.jsxs(z,{children:[e.jsxs(Q,{children:[e.jsx(q,{children:"Export Data"}),e.jsxs(G,{children:["Export ",r.name," table data"]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(i,{variant:"outline",children:"CSV"}),e.jsx(i,{variant:"outline",children:"Excel"})]})})]})]})})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(v,{children:[e.jsx(S,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:n.length===t.data.length&&t.data.length>0,onChange:re,className:"rounded"})}),d.map(s=>e.jsx(S,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s,s===l&&e.jsx(y,{variant:"outline",className:"text-xs",children:"ID"})]})},s)),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(he,{children:t.data.length>0?t.data.map((s,c)=>e.jsxs(v,{className:"hover:bg-gray-50 group",children:[e.jsx(b,{children:e.jsx("input",{type:"checkbox",checked:n.includes(s[l]),onChange:()=>ae(s[l]),className:"rounded"})}),d.map(f=>e.jsx(b,{children:e.jsx("div",{className:"max-w-xs truncate",title:String(s[f]||""),children:String(s[f]||"")})},f)),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>R(s),className:"gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Edit"]}),e.jsxs(O,{children:[e.jsx(X,{asChild:!0,children:e.jsxs(i,{size:"sm",variant:"destructive",className:"gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),"Delete"]})}),e.jsxs(be,{children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Delete Product"}),e.jsx(Se,{children:"Are you sure you want to delete this record? This action cannot be undone."})]}),e.jsxs(De,{children:[e.jsx(ke,{children:"Cancel"}),e.jsx(Ce,{onClick:()=>ee(s),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]}),e.jsxs(pe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(_e,{className:"w-4 h-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsx(fe,{children:"Actions"}),e.jsxs(D,{onClick:()=>R(s),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(D,{onClick:()=>{navigator.clipboard.writeText(s[l]),u.success("Copied to clipboard",{description:`${l}: ${s[l]}`})},children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Copy ID"]}),e.jsx(Ne,{}),e.jsx(O,{children:e.jsx(X,{asChild:!0,children:e.jsxs(D,{className:"text-red-600",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Delete"]})})})]})]})]})})]},c)):e.jsx(v,{children:e.jsx(b,{colSpan:d.length+2,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:m?"No results match your search.":"Start by adding your first product."}),e.jsx(i,{asChild:!0,children:e.jsxs("a",{href:`/product/create?conn=${a.id}&table=${r.id}`,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Add Product"]})})]})})})})]})}),t.links&&t.links.length>3&&e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",t.data.length," of many records"]}),e.jsx("div",{className:"flex gap-1",children:t.links.map((s,c)=>e.jsx("button",{onClick:()=>s.url&&h.get(s.url,{},{preserveState:!0}),className:`px-3 py-1 rounded ${s.active?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} ${s.url?"":"opacity-50 cursor-not-allowed"}`,disabled:!s.url,dangerouslySetInnerHTML:{__html:s.label}},c))})]})]})]}),e.jsx(E,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.database," @ ",a.host,":",a.port]})]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Table: ",e.jsx("strong",{children:r.table_name})]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Fields: ",e.jsx(y,{variant:"outline",children:d.length})]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Editable: ",e.jsx(y,{variant:"outline",children:M.length})]})]})})]})})})]})]})]})}export{ls as default};
