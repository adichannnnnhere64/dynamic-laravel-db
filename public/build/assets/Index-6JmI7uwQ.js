import{r as _,j as e,H as E,L as d,a as y}from"./app--mOlotUF.js";import{A as I,D as B,S as D}from"./app-layout-FdSMx8-Y.js";import{C as v,c as w,a as L,b as H,d as M}from"./card-DrKRoRG0.js";import{T as O,a as F,b as C,c as t,d as V,e as l}from"./table-DH4Y0wVM.js";import{B as x}from"./badge-DRhZ3UKT.js";import{B as i}from"./app-logo-icon-KWi9P-ev.js";import{I as q}from"./input-CBFD_EUp.js";import{S as P,a as z,b as R,c as G,d as k}from"./select-BKfzqQn2.js";import{B as S}from"./bell-DOd2zolg.js";import{P as T}from"./plus-BTB0St45.js";import{S as J}from"./search-ByfrOm_u.js";import{c as K}from"./index-BSgIEyps.js";import{C as U}from"./clock-CtJrTbMd.js";import{E as Q}from"./eye-DnEryJTR.js";import{C as W}from"./circle-alert-D9EkYXFk.js";/* empty css            */import"./index-CyI_ZakN.js";import"./index-WelwWk4r.js";import"./loader-circle-ddbBxRrc.js";import"./index-DqegC-a3.js";import"./check-BHptGlaC.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],Y=K("Filter",X);function Ne({observers:r,connections:$,filters:h}){const[m,g]=_.useState(h.search||""),[j,u]=_.useState(h.connection_id||""),p=()=>{y.get("/value-observers",{search:m||null,connection_id:j||null},{preserveState:!0})},A=a=>{const o={less_than:{label:"Less than",color:"bg-red-100 text-red-800"},greater_than:{label:"Greater than",color:"bg-green-100 text-green-800"},equals:{label:"Equals",color:"bg-blue-100 text-blue-800"},not_equals:{label:"Not equals",color:"bg-yellow-100 text-yellow-800"},contains:{label:"Contains",color:"bg-purple-100 text-purple-800"},starts_with:{label:"Starts with",color:"bg-pink-100 text-pink-800"},ends_with:{label:"Ends with",color:"bg-indigo-100 text-indigo-800"},date_near_expiry:{label:"Expires within",color:"bg-orange-100 text-orange-800"},date_expired:{label:"Expired",color:"bg-rose-100 text-rose-800"},date_future:{label:"Future date",color:"bg-emerald-100 text-emerald-800"},date_past:{label:"Past date",color:"bg-amber-100 text-amber-800"}}[a.condition_type]||{label:a.condition_type||"Unknown",color:"bg-gray-100 dark:text-white dark:bg-gray-800 text-gray-800"};let s=o.label;return a.condition_type==="date_near_expiry"&&a.days_before_alert?s+=` ${a.days_before_alert} days`:a.condition_type==="date_expired"?s+=a.alert_on_expired?" (alert)":" (no alert)":a.threshold_value!==null?s+=` ${a.threshold_value}`:a.string_value&&(s+=` "${a.string_value}"`),a.condition_type?.includes("date_")&&a.date_field_type&&(s+=` â€¢ ${a.date_field_type}`),e.jsx(x,{className:o.color,children:s})},f=a=>{if(!a)return"Never";const b=new Date(a),s=new Date().getTime()-b.getTime(),n=Math.floor(s/6e4);if(n<1)return"Just now";if(n<60)return`${n} min ago`;const c=Math.floor(n/60);if(c<24)return`${c} hour${c!==1?"s":""} ago`;const N=Math.floor(c/24);return`${N} day${N!==1?"s":""} ago`};return e.jsxs(I,{children:[e.jsx(E,{title:"Value Observers"}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Value Observers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monitor database values and get alerts"})]})]})}),e.jsx(i,{asChild:!0,children:e.jsxs(d,{href:"/value-observers/create",className:"gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Create Observer"]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(v,{className:"mb-6",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(q,{placeholder:"Search observers...",value:m,onChange:a=>g(a.target.value),onKeyDown:a=>a.key==="Enter"&&p(),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs(P,{value:j,onValueChange:u,children:[e.jsx(z,{children:e.jsx(R,{placeholder:"All connections"})}),e.jsxs(G,{children:[e.jsx(k,{value:"all",children:"All connections"})," ",$.filter(a=>a&&a.id&&a.name&&a.name.trim()!=="").map(a=>e.jsx(k,{value:a.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),a.name]})},a.id))]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:p,variant:"outline",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Apply"]}),e.jsx(i,{onClick:()=>{g(""),u(""),y.get("/value-observers")},variant:"ghost",children:"Clear"})]})]})})}),e.jsxs(v,{children:[e.jsxs(L,{children:[e.jsx(H,{children:"Active Observers"}),e.jsxs(M,{children:[r.data.length," observer",r.data.length!==1?"s":""," configured"]})]}),e.jsx(w,{children:r.data.length>0?e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(O,{children:[e.jsx(F,{children:e.jsxs(C,{children:[e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Table & Field"}),e.jsx(t,{children:"Condition"}),e.jsx(t,{children:"Check Interval"}),e.jsx(t,{children:"Last Check"}),e.jsx(t,{children:"Triggers"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(V,{children:r.data.map(a=>e.jsxs(C,{className:"hover:bg-gray-50 dark:bg-black dark:text-white",children:[e.jsx(l,{children:e.jsx(x,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})}),e.jsx(l,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-purple-600"}),a.name]})}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.connection_table.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Field: ",e.jsx("code",{children:a.field_to_watch})]}),e.jsx("div",{className:"text-xs text-gray-400",children:a.connection_table.connection.name})]})}),e.jsx(l,{children:A(a)}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),a.check_interval_minutes," min"]})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-sm",children:f(a.last_checked_at)}),a.last_triggered_at&&e.jsxs("div",{className:"text-xs text-red-600",children:["Last alert: ",f(a.last_triggered_at)]})]}),e.jsx(l,{children:e.jsxs(x,{variant:"outline",children:[a.trigger_count," time",a.trigger_count!==1?"s":""]})}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(d,{href:`/value-observers/${a.id}`,children:e.jsx(Q,{className:"w-3 h-3"})})}),e.jsx(i,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(d,{href:`/value-observers/${a.id}/edit`,children:e.jsx(D,{className:"w-3 h-3"})})})]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(W,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No observers configured"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first value observer to monitor database fields"}),e.jsx(i,{asChild:!0,children:e.jsxs(d,{href:"/value-observers/create",className:"gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Create Observer"]})})]})})]})]})]})]})}export{Ne as default};
