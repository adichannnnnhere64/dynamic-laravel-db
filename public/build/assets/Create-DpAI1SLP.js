import{r as m,u as H,j as e,H as P}from"./app-DGLSN-Ju.js";import{A as W,D as C,X as S}from"./app-layout-CNLJJ8vH.js";import{C as R,a as X,b as Y,d as J,c as K,e as Q}from"./card--aO_yzBN.js";import{S as h,a as x,b as u,c as v,d as l}from"./select-CITfpWsF.js";import{L as n}from"./label-D2zmhuGz.js";import{I as j}from"./input-DU2FS2_p.js";import{T as U,S as Z}from"./textarea-DT3tAnej.js";import{B as p}from"./app-logo-icon-CiKcDI3y.js";import{B as $}from"./badge-D22UW-W-.js";import{S as f}from"./separator-Bg5MGCAm.js";import{S as ee}from"./switch-CJxtLWoX.js";import{G as se,t as g}from"./index-laRRW53S.js";import{C as ae}from"./chevron-left-BRegcnQN.js";import{B as E}from"./bell-DycnXRQ5.js";import{M as te}from"./mail--z1WOptS.js";import{P as ie}from"./plus-477rSdyV.js";/* empty css            */import"./index-BTuH0LaR.js";import"./index-Ct4EE1HF.js";import"./index-CSpiwRm-.js";import"./index-8FkM75eG.js";import"./check-Bfsx1j1P.js";function Ee({connections:b,selectedConnection:k,selectedTable:F,fields:V}){const[o,q]=m.useState(k?.id?.toString()||""),[c,N]=m.useState(F?.id?.toString()||""),[y,A]=m.useState([]),[T,w]=m.useState(V||[]),{data:t,setData:i,post:I,processing:_,errors:a}=H({connection_table_id:c?parseInt(c):"",name:"",field_to_watch:"",condition_type:"less_than",threshold_value:"",string_value:"",is_active:!0,notification_emails:[""],notification_subject:"Database Alert: {observer_name}",notification_message:'The condition "{condition}" has been met for field "{field}" in table "{table_name}". Current value: {current_value}',check_interval_minutes:60});m.useEffect(()=>{if(o){const s=b.find(r=>r.id.toString()===o);A(s?.tables||[]),N(""),i("connection_table_id",""),w([])}},[o]),m.useEffect(()=>{if(c){const s=y.find(r=>r.id.toString()===c);w(s?.fields||[]),i("connection_table_id",parseInt(c)),s?.fields?.length>0&&!t.field_to_watch&&i("field_to_watch",s.fields[0])}},[c]);const O=s=>{if(s.preventDefault(),t.notification_emails.filter(d=>d&&d.trim()!=="").length===0){g.error("At least one notification email is required");return}I("/value-observers",{preserveScroll:!0,onSuccess:()=>{g.success("Value Observer Created",{description:"Your observer has been created successfully"})},onError:()=>{g.error("Creation Failed",{description:"Please check the form for errors"})}})},D=()=>{i("notification_emails",[...t.notification_emails,""])},B=s=>{if(t.notification_emails.length>1){const r=t.notification_emails.filter((d,G)=>G!==s);i("notification_emails",r)}},L=(s,r)=>{const d=[...t.notification_emails];d[s]=r,i("notification_emails",d)},M=[{value:"less_than",label:"Less than",description:"Value is less than threshold"},{value:"greater_than",label:"Greater than",description:"Value is greater than threshold"},{value:"equals",label:"Equals",description:"Value equals threshold"},{value:"not_equals",label:"Not equals",description:"Value does not equal threshold"},{value:"contains",label:"Contains",description:"Value contains text"},{value:"starts_with",label:"Starts with",description:"Value starts with text"},{value:"ends_with",label:"Ends with",description:"Value ends with text"}],z=()=>{switch(t.condition_type){case"less_than":case"greater_than":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"threshold_value",children:"Threshold Value"}),e.jsx(j,{id:"threshold_value",type:"number",step:"any",value:t.threshold_value,onChange:s=>i("threshold_value",s.target.value),placeholder:"Enter threshold value",required:!0}),a.threshold_value&&e.jsx("p",{className:"text-sm text-red-600",children:a.threshold_value})]});case"equals":case"not_equals":case"contains":case"starts_with":case"ends_with":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"string_value",children:"Text Value"}),e.jsx(j,{id:"string_value",value:t.string_value,onChange:s=>i("string_value",s.target.value),placeholder:"Enter text to compare",required:!0}),a.string_value&&e.jsx("p",{className:"text-sm text-red-600",children:a.string_value})]});default:return null}};return e.jsxs(W,{children:[e.jsx(P,{title:"Create Value Observer"}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Create Value Observer"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monitor database values and get alerts"})]})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(R,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Observer Configuration"}),e.jsx(J,{children:"Configure what to monitor and when to alert"})]}),e.jsx(K,{children:e.jsxs("form",{onSubmit:O,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Step 1: Select Database & Table"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"connection",children:"Database Connection"}),e.jsxs(h,{value:o,onValueChange:q,children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select a connection"})}),e.jsx(v,{children:b.filter(s=>s&&s.id&&s.name).map(s=>e.jsx(l,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),s.name]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"table",children:"Table"}),e.jsxs(h,{value:c,onValueChange:N,disabled:!o,children:[e.jsx(x,{children:e.jsx(u,{placeholder:o?"Select a table":"Select connection first"})}),e.jsx(v,{children:y.filter(s=>s&&s.id&&s.name).map(s=>e.jsx(l,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),s.name,e.jsx($,{variant:"outline",className:"ml-2 text-xs",children:s.table_name})]})},s.id))})]})]})]}),a.connection_table_id&&e.jsx("p",{className:"text-sm text-red-600",children:a.connection_table_id})]}),e.jsx(f,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Step 2: Configure What to Watch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Observer Name"}),e.jsx(j,{id:"name",value:t.name,onChange:s=>i("name",s.target.value),placeholder:"e.g., Low Stock Alert",required:!0}),a.name&&e.jsx("p",{className:"text-sm text-red-600",children:a.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"field_to_watch",children:"Field to Watch"}),e.jsxs(h,{value:t.field_to_watch,onValueChange:s=>i("field_to_watch",s),disabled:!c,children:[e.jsx(x,{children:e.jsx(u,{placeholder:c?"Select a field":"Select table first"})}),e.jsx(v,{children:T.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(l,{value:s,children:s},s))})]}),a.field_to_watch&&e.jsx("p",{className:"text-sm text-red-600",children:a.field_to_watch})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"condition_type",children:"Condition Type"}),e.jsxs(h,{value:t.condition_type,onValueChange:s=>i("condition_type",s),children:[e.jsx(x,{children:e.jsx(u,{})}),e.jsx(v,{children:M.map(s=>e.jsx(l,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]}),a.condition_type&&e.jsx("p",{className:"text-sm text-red-600",children:a.condition_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Condition Value"}),z()]})]})]}),e.jsx(f,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Step 3: Notification Settings"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Notification Emails"}),e.jsx("div",{className:"space-y-3 mt-2",children:t.notification_emails.map((s,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"email",value:s,onChange:d=>L(r,d.target.value),placeholder:"email@example.com",required:r===0}),t.notification_emails.length>1&&e.jsx(p,{type:"button",variant:"outline",size:"icon",onClick:()=>B(r),children:e.jsx(S,{className:"w-4 h-4"})})]},r))}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:D,className:"mt-2",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Add Another Email"]}),a.notification_emails&&e.jsx("p",{className:"text-sm text-red-600",children:a.notification_emails})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_subject",children:"Email Subject"}),e.jsx(j,{id:"notification_subject",value:t.notification_subject,onChange:s=>i("notification_subject",s.target.value),placeholder:"Alert: {observer_name}",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}"]}),a.notification_subject&&e.jsx("p",{className:"text-sm text-red-600",children:a.notification_subject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_message",children:"Email Message"}),e.jsx(U,{id:"notification_message",value:t.notification_message,onChange:s=>i("notification_message",s.target.value),rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}",", ","{current_value}",", ","{record_id}"]}),a.notification_message&&e.jsx("p",{className:"text-sm text-red-600",children:a.notification_message})]})]})]}),e.jsx(f,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Step 4: Schedule & Activation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"check_interval_minutes",children:"Check Interval (minutes)"}),e.jsxs(h,{value:t.check_interval_minutes.toString(),onValueChange:s=>i("check_interval_minutes",parseInt(s)),children:[e.jsx(x,{children:e.jsx(u,{})}),e.jsxs(v,{children:[e.jsx(l,{value:"1",children:"Every minute"}),e.jsx(l,{value:"2",children:"Every 2 minutes"}),e.jsx(l,{value:"3",children:"Every 3 minutes"}),e.jsx(l,{value:"5",children:"Every 5 minutes"}),e.jsx(l,{value:"15",children:"Every 15 minutes"}),e.jsx(l,{value:"30",children:"Every 30 minutes"}),e.jsx(l,{value:"60",children:"Every hour"}),e.jsx(l,{value:"180",children:"Every 3 hours"}),e.jsx(l,{value:"360",children:"Every 6 hours"}),e.jsx(l,{value:"720",children:"Every 12 hours"}),e.jsx(l,{value:"1440",children:"Every day"})]})]}),a.check_interval_minutes&&e.jsx("p",{className:"text-sm text-red-600",children:a.check_interval_minutes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"is_active",children:"Observer Status"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Active"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.is_active?"Observer is active and will check":"Observer is paused"})]}),e.jsx(ee,{checked:t.is_active,onCheckedChange:s=>i("is_active",s)})]}),a.is_active&&e.jsx("p",{className:"text-sm text-red-600",children:a.is_active})]})]})]}),e.jsx(Q,{className:"px-0 pb-0 pt-6",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs(p,{type:"button",variant:"outline",onClick:()=>window.history.back(),disabled:_,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsx(p,{type:"submit",disabled:_,className:"gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),"Create Observer"]})})]})})]})})]})})]})]})}export{Ee as default};
