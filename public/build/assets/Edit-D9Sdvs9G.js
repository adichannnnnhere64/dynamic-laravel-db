import{r as h,u as K,j as e,H as Q,a as Z}from"./app-DGLSN-Ju.js";import{A as ee,D as V,X as A}from"./app-layout-CNLJJ8vH.js";import{C as u,c as j,a as L,b as q,d as se,e as ae}from"./card--aO_yzBN.js";import{S as y,a as w,b as C,c as k,d as c}from"./select-CITfpWsF.js";import{L as n}from"./label-D2zmhuGz.js";import{I as p}from"./input-DU2FS2_p.js";import{T as te,S as ie}from"./textarea-DT3tAnej.js";import{c as le,B as m}from"./app-logo-icon-CiKcDI3y.js";import{B as I}from"./badge-D22UW-W-.js";import{S}from"./separator-Bg5MGCAm.js";import{S as ne}from"./switch-CJxtLWoX.js";import{G as re,t as v}from"./index-laRRW53S.js";import{C as ce}from"./chevron-left-BRegcnQN.js";import{B as D}from"./bell-DycnXRQ5.js";import{M as de}from"./mail--z1WOptS.js";import{P as oe}from"./plus-477rSdyV.js";import{C as he}from"./circle-alert-zn6odLoO.js";/* empty css            */import"./index-BTuH0LaR.js";import"./index-Ct4EE1HF.js";import"./index-CSpiwRm-.js";import"./index-8FkM75eG.js";import"./check-Bfsx1j1P.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],xe=le("TestTube",me);function Ue({observer:a,connections:E,selectedConnection:o,selectedTable:x,fields:_}){const[ue,O]=h.useState(o?.id?.toString()||""),[N,B]=h.useState(x?.id?.toString()||""),[T,U]=h.useState([]),[g,F]=h.useState(_||[]),[b,je]=h.useState(!1),{data:i,setData:r,put:M,processing:f,errors:t}=K({name:a.name||"",field_to_watch:a.field_to_watch||"",condition_type:a.condition_type||"less_than",threshold_value:a.threshold_value||"",string_value:a.string_value||"",is_active:a.is_active??!0,notification_emails:a.notification_emails||[""],notification_subject:a.notification_subject||"Database Alert: {observer_name}",notification_message:a.notification_message||'The condition "{condition}" has been met for field "{field}" in table "{table_name}". Current value: {current_value}',check_interval_minutes:a.check_interval_minutes||60});h.useEffect(()=>{if(o){O(o.id.toString());const s=E.find(l=>l.id===o.id);s?.tables&&U(s.tables),B(x?.id?.toString()||""),F(_||[])}},[o,x,E,_]),h.useEffect(()=>{if(N){const s=T.find(l=>l.id.toString()===N);s?.fields&&F(s.fields)}},[N,T]);const $=s=>{if(s.preventDefault(),i.notification_emails.filter(d=>d&&d.trim()!=="").length===0){v.error("At least one notification email is required");return}M(`/value-observers/${a.id}`,{preserveScroll:!0,onSuccess:()=>{v.success("Value Observer Updated",{description:"Your observer has been updated successfully"})},onError:()=>{v.error("Update Failed",{description:"Please check the form for errors"})}})},W=()=>{Z.post(`/value-observers/${a.id}/test`,{},{preserveScroll:!0,onSuccess:s=>{v.success("Test Completed",{description:`Checked ${s.props.total_records} records, ${s.props.condition_met_count} met the condition`})},onError:()=>{v.error("Test Failed",{description:"Unable to test the observer"})}})},z=()=>{r("notification_emails",[...i.notification_emails,""])},G=s=>{if(i.notification_emails.length>1){const l=i.notification_emails.filter((d,J)=>J!==s);r("notification_emails",l)}},H=(s,l)=>{const d=[...i.notification_emails];d[s]=l,r("notification_emails",d)},P=[{value:"less_than",label:"Less than",description:"Value is less than threshold"},{value:"greater_than",label:"Greater than",description:"Value is greater than threshold"},{value:"equals",label:"Equals",description:"Value equals threshold"},{value:"not_equals",label:"Not equals",description:"Value does not equal threshold"},{value:"contains",label:"Contains",description:"Value contains text"},{value:"starts_with",label:"Starts with",description:"Value starts with text"},{value:"ends_with",label:"Ends with",description:"Value ends with text"}],R=()=>{switch(i.condition_type){case"less_than":case"greater_than":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"threshold_value",children:"Threshold Value"}),e.jsx(p,{id:"threshold_value",type:"number",step:"any",value:i.threshold_value,onChange:s=>r("threshold_value",s.target.value),placeholder:"Enter threshold value",required:!0}),t.threshold_value&&e.jsx("p",{className:"text-sm text-red-600",children:t.threshold_value})]});case"equals":case"not_equals":case"contains":case"starts_with":case"ends_with":return e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"string_value",children:"Text Value"}),e.jsx(p,{id:"string_value",value:i.string_value,onChange:s=>r("string_value",s.target.value),placeholder:"Enter text to compare",required:!0}),t.string_value&&e.jsx("p",{className:"text-sm text-red-600",children:t.string_value})]});default:return null}},X=()=>a.is_active?e.jsx(I,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Active"}):e.jsx(I,{variant:"outline",className:"bg-gray-50 dark:bg-black text-gray-700 border-gray-200",children:"Inactive"}),Y=()=>a.last_checked_at?new Date(a.last_checked_at).toLocaleString():"Never";return e.jsxs(ee,{children:[e.jsx(Q,{title:`Edit ${a.name}`}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>window.history.back(),className:"gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(D,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Edit Value Observer"}),X()]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update your monitoring configuration"})]})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(u,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.trigger_count}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Alerts Triggered"})]})}),e.jsx(u,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.last_checked_at?"✓":"—"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Last checked: ",Y()]})]})}),e.jsx(u,{children:e.jsxs(j,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:a.last_triggered_at?"⚠️":"✓"}),e.jsx("div",{className:"text-sm text-gray-500",children:a.last_triggered_at?`Last alert: ${new Date(a.last_triggered_at).toLocaleString()}`:"No alerts triggered"})]})})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs(u,{children:[e.jsxs(L,{children:[e.jsx(q,{children:"Observer Configuration"}),e.jsx(se,{children:"Update what to monitor and when to alert"})]}),e.jsx(j,{children:e.jsxs("form",{onSubmit:$,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Database & Table"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Database Connection"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 dark:bg-black",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:o?.name})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cannot be changed after creation"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Table"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 dark:bg-black",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:x?.name})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Cannot be changed after creation"})]})]})]})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"What to Watch"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Observer Name"}),e.jsx(p,{id:"name",value:i.name,onChange:s=>r("name",s.target.value),placeholder:"e.g., Low Stock Alert",required:!0}),t.name&&e.jsx("p",{className:"text-sm text-red-600",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"field_to_watch",children:"Field to Watch"}),e.jsxs(y,{value:i.field_to_watch,onValueChange:s=>r("field_to_watch",s),disabled:b||g.length===0,children:[e.jsx(w,{children:b?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"}),"Loading fields..."]}):e.jsx(C,{placeholder:g.length===0?"No fields available":"Select a field"})}),e.jsx(k,{children:g.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(c,{value:s,children:s},s))})]}),g.length===0&&!b&&e.jsx("p",{className:"text-sm text-yellow-600",children:"No fields found for this table"}),t.field_to_watch&&e.jsx("p",{className:"text-sm text-red-600",children:t.field_to_watch})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"condition_type",children:"Condition Type"}),e.jsxs(y,{value:i.condition_type,onValueChange:s=>r("condition_type",s),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsx(k,{children:P.map(s=>e.jsx(c,{value:s.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})},s.value))})]}),t.condition_type&&e.jsx("p",{className:"text-sm text-red-600",children:t.condition_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Condition Value"}),R()]})]})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Notification Settings"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Notification Emails"}),e.jsx("div",{className:"space-y-3 mt-2",children:i.notification_emails.map((s,l)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"email",value:s,onChange:d=>H(l,d.target.value),placeholder:"email@example.com",required:l===0}),i.notification_emails.length>1&&e.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>G(l),children:e.jsx(A,{className:"w-4 h-4"})})]},l))}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:z,className:"mt-2",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Add Another Email"]}),t.notification_emails&&e.jsx("p",{className:"text-sm text-red-600",children:t.notification_emails})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_subject",children:"Email Subject"}),e.jsx(p,{id:"notification_subject",value:i.notification_subject,onChange:s=>r("notification_subject",s.target.value),placeholder:"Alert: {observer_name}",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}"]}),t.notification_subject&&e.jsx("p",{className:"text-sm text-red-600",children:t.notification_subject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notification_message",children:"Email Message"}),e.jsx(te,{id:"notification_message",value:i.notification_message,onChange:s=>r("notification_message",s.target.value),rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Available variables: ","{observer_name}",", ","{table_name}",", ","{field}",", ","{condition}",", ","{current_value}",", ","{record_id}"]}),t.notification_message&&e.jsx("p",{className:"text-sm text-red-600",children:t.notification_message})]})]})]}),e.jsx(S,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Schedule & Activation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"check_interval_minutes",children:"Check Interval (minutes)"}),e.jsxs(y,{value:i.check_interval_minutes.toString(),onValueChange:s=>r("check_interval_minutes",parseInt(s)),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsxs(k,{children:[e.jsx(c,{value:"1",children:"Every minute"}),e.jsx(c,{value:"2",children:"Every 2 minutes"}),e.jsx(c,{value:"3",children:"Every 3 minutes"}),e.jsx(c,{value:"15",children:"Every 15 minutes"}),e.jsx(c,{value:"30",children:"Every 30 minutes"}),e.jsx(c,{value:"60",children:"Every hour"}),e.jsx(c,{value:"180",children:"Every 3 hours"}),e.jsx(c,{value:"360",children:"Every 6 hours"}),e.jsx(c,{value:"720",children:"Every 12 hours"}),e.jsx(c,{value:"1440",children:"Every day"})]})]}),t.check_interval_minutes&&e.jsx("p",{className:"text-sm text-red-600",children:t.check_interval_minutes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"is_active",children:"Observer Status"}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Active"}),e.jsx("div",{className:"text-sm text-gray-500",children:i.is_active?"Observer is active and will check":"Observer is paused"})]}),e.jsx(ne,{checked:i.is_active,onCheckedChange:s=>r("is_active",s)})]}),t.is_active&&e.jsx("p",{className:"text-sm text-red-600",children:t.is_active})]})]})]}),e.jsx(ae,{className:"px-0 pb-0 pt-6",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>window.history.back(),disabled:f,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(m,{type:"button",variant:"outline",onClick:W,disabled:f,className:"gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Test"]})]}),e.jsx(m,{type:"submit",disabled:f,className:"gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Save Changes"]})})]})})]})})]}),e.jsxs(u,{className:"mt-6",children:[e.jsx(L,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Observer Information"]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Current Configuration"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{children:new Date(a.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Updated:"}),e.jsx("span",{children:new Date(a.updated_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Database:"}),e.jsx("span",{children:o?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Table:"}),e.jsx("span",{children:x?.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Field to Watch:"}),e.jsx("span",{children:a.field_to_watch})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Condition:"}),e.jsx("span",{children:a.condition_type?.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Check Interval:"}),e.jsxs("span",{children:["Every ",a.check_interval_minutes," minutes"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Testing"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use the Test button to immediately check the current observer configuration against up to 10 records. This will show you which records currently meet your condition without triggering email notifications."})]})]})})]})]})]})]})}export{Ue as default};
