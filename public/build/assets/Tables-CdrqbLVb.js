import{r as N,j as e,u as Ue,a as z,L as V}from"./app-DeAqZtZ3.js";import{u as Ye,a as Ze,c as we,R as Je,I as We,A as Xe,D as H,S as ue}from"./app-layout-DgaGjPfW.js";import{C as Y,a as xe,b as he,d as pe,c as Z}from"./card-kVUHXLHN.js";import{D as es,a as ss,b as as,c as ts,d as ls,e as is,f as rs}from"./dialog-DM01r7wC.js";import{A as ns,a as cs,b as os,c as ds,d as ms,e as us,f as xs,g as hs,h as ps}from"./alert-dialog-CY351Vxv.js";import{T as fs,a as js,b as fe,c as F,d as ys,e as I}from"./table-CCH9otKR.js";import{u as bs,c as gs,a as J,P as vs}from"./index-BJC1wku9.js";import{P as B}from"./index-CHvhUF_F.js";import{c as $,a as O,B as _}from"./app-logo-icon-B8fPI5Uv.js";import{I as L}from"./input-El65ufWx.js";import{L as q}from"./label-q7ELVbuS.js";import{B as C}from"./badge-CsmQxwCr.js";import{S as W,a as X,b as ee,c as se,d as ae}from"./select-BWbxT2Ox.js";import{S as je}from"./switch-C8ijd_x8.js";import{t as k,G as M}from"./index-zmOtbO7e.js";import{C as Ns}from"./chevron-left-CQc-T97E.js";import{R as ye}from"./refresh-cw-DDxkrB5J.js";import{S as te}from"./search--k5Ytm7V.js";import{C as ws}from"./circle-alert-FkiZYEb1.js";import{L as _s}from"./loader-circle-BcDjCRRu.js";import{C as le}from"./check-Dz_lJkVu.js";import{P as be}from"./plus-NO3iVm8d.js";import{S as Cs}from"./square-pen-CA9WN33R.js";import{E as Ts}from"./eye-D3Y--fXN.js";import{T as ks}from"./trash-2-DO40vy5d.js";import{C as K}from"./calendar-DgH1bh-H.js";import{M as Ss}from"./mail-CqSYOCUz.js";/* empty css            */import"./index-CSpiwRm-.js";import"./index-BnX7B4NS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Es=$("Columns2",As);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],G=$("FileText",Ds);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Is=$("Globe",Fs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ge=$("Hash",$s);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ie=$("Key",Ps);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ms=$("Shield",Ls);var Q="Tabs",[Rs,wa]=gs(Q,[we]),_e=we(),[zs,re]=Rs(Q),Ce=N.forwardRef((l,u)=>{const{__scopeTabs:w,value:b,onValueChange:f,defaultValue:h,orientation:p="horizontal",dir:j,activationMode:S="automatic",...A}=l,g=Ye(j),[c,T]=bs({prop:b,onChange:f,defaultProp:h??"",caller:Q});return e.jsx(zs,{scope:w,baseId:Ze(),value:c,onValueChange:T,orientation:p,dir:g,activationMode:S,children:e.jsx(B.div,{dir:g,"data-orientation":p,...A,ref:u})})});Ce.displayName=Q;var Te="TabsList",ke=N.forwardRef((l,u)=>{const{__scopeTabs:w,loop:b=!0,...f}=l,h=re(Te,w),p=_e(w);return e.jsx(Je,{asChild:!0,...p,orientation:h.orientation,dir:h.dir,loop:b,children:e.jsx(B.div,{role:"tablist","aria-orientation":h.orientation,...f,ref:u})})});ke.displayName=Te;var Se="TabsTrigger",Ae=N.forwardRef((l,u)=>{const{__scopeTabs:w,value:b,disabled:f=!1,...h}=l,p=re(Se,w),j=_e(w),S=Fe(p.baseId,b),A=Ie(p.baseId,b),g=b===p.value;return e.jsx(We,{asChild:!0,...j,focusable:!f,active:g,children:e.jsx(B.button,{type:"button",role:"tab","aria-selected":g,"aria-controls":A,"data-state":g?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:S,...h,ref:u,onMouseDown:J(l.onMouseDown,c=>{!f&&c.button===0&&c.ctrlKey===!1?p.onValueChange(b):c.preventDefault()}),onKeyDown:J(l.onKeyDown,c=>{[" ","Enter"].includes(c.key)&&p.onValueChange(b)}),onFocus:J(l.onFocus,()=>{const c=p.activationMode!=="manual";!g&&!f&&c&&p.onValueChange(b)})})})});Ae.displayName=Se;var Ee="TabsContent",De=N.forwardRef((l,u)=>{const{__scopeTabs:w,value:b,forceMount:f,children:h,...p}=l,j=re(Ee,w),S=Fe(j.baseId,b),A=Ie(j.baseId,b),g=b===j.value,c=N.useRef(g);return N.useEffect(()=>{const T=requestAnimationFrame(()=>c.current=!1);return()=>cancelAnimationFrame(T)},[]),e.jsx(vs,{present:f||g,children:({present:T})=>e.jsx(B.div,{"data-state":g?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":S,hidden:!T,id:A,tabIndex:0,...p,ref:u,style:{...l.style,animationDuration:c.current?"0s":void 0},children:T&&h})})});De.displayName=Ee;function Fe(l,u){return`${l}-trigger-${u}`}function Ie(l,u){return`${l}-content-${u}`}var Vs=Ce,Hs=ke,qs=Ae,Ks=De;function Gs({className:l,...u}){return e.jsx(Vs,{"data-slot":"tabs",className:O("flex flex-col gap-2",l),...u})}function Bs({className:l,...u}){return e.jsx(Hs,{"data-slot":"tabs-list",className:O("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",l),...u})}function ve({className:l,...u}){return e.jsx(qs,{"data-slot":"tabs-trigger",className:O("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",l),...u})}function Ne({className:l,...u}){return e.jsx(Ks,{"data-slot":"tabs-content",className:O("flex-1 outline-none",l),...u})}function _a({connection:l,actualTables:u,flash:w}){const[b,f]=N.useState(!1),[h,p]=N.useState(""),[j,S]=N.useState([]),[A,g]=N.useState({}),[c,T]=N.useState(null),[P,R]=N.useState(!1),[$e,Pe]=N.useState("configured"),[D,U]=N.useState(""),{data:r,setData:y,post:Os,processing:ne,errors:E,reset:ce,clearErrors:Le}=Ue({table_name:"",name:"",primary_key:"",fields:[],editable_fields:[],input_types:{},is_active:!0,order:l.tables?.length||0});N.useEffect(()=>{w?.success&&k.success(w.success),w?.error&&k.error(w.error)},[w]),N.useEffect(()=>{h&&h!==c?.table_name&&Me(h)},[h]);const Me=async s=>{R(!0);try{const a=await fetch(`/api/connection/${l.id}/tables/${s}/columns`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=await a.json();if(console.log("API Response for edit:",i),console.log("Editing table input_types:",c?.input_types),i.error)throw new Error(i.error);if(i.columns&&Array.isArray(i.columns)){const n=i.columns.filter(o=>o&&o.trim()!==""),x={};i.types&&Array.isArray(i.types)?n.forEach((o,t)=>{x[o]=i.types[t]||"varchar"}):n.forEach(o=>{x[o]="varchar"}),S(n),g(x);let d={};c?.input_types?(d={...c.input_types},n.forEach(o=>{if(!d[o]){const t=(x[o]||"varchar").toLowerCase();let m="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?m="number":t.includes("date")?m="date":t.includes("datetime")||t.includes("timestamp")?m="datetime-local":t.includes("time")?m="time":t.includes("text")||t.includes("blob")?m="textarea":t.includes("enum")?m="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(m="checkbox"),d[o]=m}})):n.forEach(o=>{const t=(x[o]||"varchar").toLowerCase();let m="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?m="number":t.includes("date")?m="date":t.includes("datetime")||t.includes("timestamp")?m="datetime-local":t.includes("time")?m="time":t.includes("text")||t.includes("blob")?m="textarea":t.includes("enum")?m="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(m="checkbox"),d[o]=m});const v=c?.primary_key||n[0]||"id";console.log("Final input types to set:",d),y({...r,table_name:s,name:c?.name||s,primary_key:c?.primary_key||v,fields:c?.fields||n,editable_fields:c?.editable_fields||n.filter(o=>o!==v),input_types:d})}else throw new Error("No columns found in response")}catch(a){console.error("Failed to fetch columns:",a),k.error("Connection Error",{description:"Could not fetch table structure from database"})}finally{R(!1)}},Re=s=>{if(s.preventDefault(),Le(),!r.table_name){k.error("Please select a table from the database");return}if(!r.name.trim()){k.error("Display name is required");return}if(!r.primary_key){k.error("Primary key is required");return}if(r.fields.includes(r.primary_key)||y("fields",[r.primary_key,...r.fields.filter(x=>x!==r.primary_key)]),r.fields.length===0){k.error("At least one field must be selected");return}const a={...r.input_types};r.fields.forEach(x=>{if(!a[x]){const d=A[x]||"varchar";let v="text";d.includes("int")||d.includes("decimal")||d.includes("float")||d.includes("double")?v="number":d.includes("date")?v="date":d.includes("datetime")||d.includes("timestamp")?v="datetime-local":d.includes("time")?v="time":d.includes("text")||d.includes("blob")?v="textarea":d.includes("enum")?v="select":(d.includes("set")||d==="tinyint(1)"||d.includes("boolean"))&&(v="checkbox"),a[x]=v}}),y("input_types",a);const i=`/connect/${l.id}/tables`;z[c?"put":"post"](i,{...r,input_types:a,id:c?.id},{preserveScroll:!0,onSuccess:()=>{ce(),f(!1),p(""),T(null),S([]),g({})},onError:x=>{console.error("Form errors:",x),k.error("Please check your form for errors")}})},oe=async s=>{console.log("Editing table:",s),console.log("Table input_types:",s.input_types),T(s),f(!0),p(s.table_name),y({table_name:s.table_name,name:s.name,primary_key:s.primary_key,fields:s.fields,editable_fields:s.editable_fields||[],input_types:s.input_types||{},is_active:s.is_active,order:s.order}),await ze(s.table_name,s.input_types||{})},ze=async(s,a)=>{R(!0);try{const i=await fetch(`/api/connection/${l.id}/tables/${s}/columns`);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const n=await i.json();if(console.log("API Response for edit:",n),console.log("Saved input_types:",a),n.error)throw new Error(n.error);if(n.columns&&Array.isArray(n.columns)){const x=n.columns.filter(o=>o&&o.trim()!==""),d={};n.types&&Array.isArray(n.types)?x.forEach((o,t)=>{d[o]=n.types[t]||"varchar"}):x.forEach(o=>{d[o]="varchar"}),S(x),g(d);const v={...a};x.forEach(o=>{if(!v[o]){const t=(d[o]||"varchar").toLowerCase();let m="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?m="number":t.includes("date")?m="date":t.includes("datetime")||t.includes("timestamp")?m="datetime-local":t.includes("time")?m="time":t.includes("text")||t.includes("blob")?m="textarea":t.includes("enum")?m="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(m="checkbox"),v[o]=m}}),console.log("Final input types to set:",v),y(o=>({...o,fields:x,input_types:v}))}}catch(i){console.error("Failed to fetch columns:",i),k.error("Connection Error",{description:"Could not fetch table structure from database"})}finally{R(!1)}},Ve=s=>{z.delete(`/connect/${l.id}/tables/${s}`,{preserveScroll:!0,onSuccess:()=>{k.success("Table configuration deleted")},onError:()=>{k.error("Could not delete the table configuration")}})},He=s=>{const a=r.editable_fields.includes(s)?r.editable_fields.filter(i=>i!==s):[...r.editable_fields,s];y("editable_fields",a)},qe=(s,a)=>{y("input_types",{...r.input_types,[s]:a})},Ke=()=>{const s=[r.primary_key].filter(i=>j.includes(i)&&i&&i.trim()!=="");y("fields",s),y("editable_fields",[]);const a={};r.primary_key&&(a[r.primary_key]=r.input_types[r.primary_key]||"text"),y("input_types",a)},Ge=s=>{const a=r.fields.includes(s)?r.fields.filter(i=>i!==s):[...r.fields,s];if(y("fields",a),!a.includes(s)){const i=r.editable_fields.filter(x=>x!==s);y("editable_fields",i);const n={...r.input_types};delete n[s],y("input_types",n)}},Be=()=>{y("fields",j),y("editable_fields",j.filter(s=>s!==r.primary_key))},Oe=s=>{const a=s.toLowerCase();return a.includes("int")||a.includes("decimal")||a.includes("float")?e.jsx(ge,{className:"w-4 h-4"}):a.includes("date")||a.includes("time")?e.jsx(K,{className:"w-4 h-4"}):a.includes("text")||a.includes("blob")?e.jsx(G,{className:"w-4 h-4"}):a.includes("enum")||a.includes("set")?e.jsx(M,{className:"w-4 h-4"}):a.includes("char")||a.includes("varchar")?e.jsx(V,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})},Qe=()=>[{value:"text",label:"Text",icon:e.jsx(G,{className:"w-4 h-4"})},{value:"number",label:"Number",icon:e.jsx(ge,{className:"w-4 h-4"})},{value:"email",label:"Email",icon:e.jsx(Ss,{className:"w-4 h-4"})},{value:"date",label:"Date",icon:e.jsx(K,{className:"w-4 h-4"})},{value:"datetime-local",label:"Date Time",icon:e.jsx(K,{className:"w-4 h-4"})},{value:"time",label:"Time",icon:e.jsx(K,{className:"w-4 h-4"})},{value:"textarea",label:"Text Area",icon:e.jsx(G,{className:"w-4 h-4"})},{value:"select",label:"Dropdown",icon:e.jsx(M,{className:"w-4 h-4"})},{value:"checkbox",label:"Checkbox",icon:e.jsx(le,{className:"w-4 h-4"})},{value:"password",label:"Password",icon:e.jsx(Ms,{className:"w-4 h-4"})},{value:"url",label:"URL",icon:e.jsx(V,{className:"w-4 h-4"})}],de=u.filter(s=>s.toLowerCase().includes(D.toLowerCase())),me=l.tables?.filter(s=>s.name.toLowerCase().includes(D.toLowerCase())||s.table_name.toLowerCase().includes(D.toLowerCase()))||[];return e.jsx(Xe,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"border-b bg-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>z.visit("/connect"),className:"gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Table Management"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Is,{className:"w-3 h-3 mr-1"}),l.host,":",l.port]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-medium",children:l.database}),e.jsx("span",{children:"•"}),e.jsx("span",{children:l.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(_,{variant:"outline",onClick:()=>z.reload({preserveScroll:!0}),className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(es,{open:b,onOpenChange:f,children:[e.jsx(ss,{asChild:!0}),e.jsxs(as,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ts,{children:[e.jsxs(ls,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),c?`Edit Table: ${c.name}`:"Configure New Table"]}),e.jsx(is,{children:"Configure how this database table should be displayed and managed in the application"})]}),e.jsxs("form",{onSubmit:Re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{htmlFor:"table_name",children:"Database Table *"}),e.jsxs(W,{value:h,onValueChange:p,disabled:!!c,children:[e.jsx(X,{className:`${E.table_name?"border-red-500":""}`,children:e.jsx(ee,{placeholder:"Select a table from database",children:h||"Select a table"})}),e.jsxs(se,{children:[e.jsx("div",{className:"p-2 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Search tables...",value:D,onChange:s=>U(s.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:de.filter(s=>s&&s.trim()!=="").map(s=>{const a=l.tables?.some(i=>i.table_name===s);return e.jsx(ae,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:s})]}),a&&e.jsx(C,{variant:"outline",className:"text-xs",children:"Configured"})]})},s)})})]})]}),E.table_name&&e.jsx("p",{className:"text-red-500 text-sm",children:E.table_name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{htmlFor:"name",children:"Display Name *"}),e.jsx(L,{id:"name",value:r.name,onChange:s=>y("name",s.target.value),placeholder:"e.g., Products Inventory",className:E.name?"border-red-500":"",required:!0}),E.name&&e.jsx("p",{className:"text-red-500 text-sm",children:E.name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(q,{htmlFor:"primary_key",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Primary Key *"]}),e.jsxs(W,{value:r.primary_key,onValueChange:s=>y("primary_key",s),disabled:P||j.length===0,children:[e.jsx(X,{className:`${E.primary_key?"border-red-500":""}`,children:e.jsx(ee,{placeholder:P?"Loading...":j.length===0?"No columns":"Select primary key"})}),e.jsx(se,{children:j.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(ae,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(C,{variant:"outline",className:"ml-2 text-xs font-mono",children:A[s]||"varchar"})]})},s))})]}),E.primary_key&&e.jsx("p",{className:"text-red-500 text-sm",children:E.primary_key})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{htmlFor:"order",children:"Display Order"}),e.jsx(L,{id:"order",type:"number",value:r.order,onChange:s=>y("order",parseInt(s.target.value)||0),placeholder:"0"})]})]})]}),P?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(ye,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Loading table structure..."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fetching columns from ",h]})]})]}):j.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5"}),"Column Configuration",e.jsxs(C,{variant:"outline",className:"ml-2",children:[j.length," columns"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Be,children:"Select All"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Ke,children:"Deselect All"})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-1 text-center",children:"Show"}),e.jsx("div",{className:"col-span-3",children:"Column"}),e.jsx("div",{className:"col-span-2",children:"Type"}),e.jsx("div",{className:"col-span-2 text-center",children:"Editable"}),e.jsx("div",{className:"col-span-3",children:"Input Type"}),e.jsx("div",{className:"col-span-1",children:"Properties"})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:j.filter(s=>s&&s.trim()!=="").map(s=>{const a=A[s]||"varchar",i=s===r.primary_key;return e.jsx("div",{className:`px-4 py-3 border-b hover:bg-gray-50 ${i?"bg-yellow-50":""}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(je,{checked:r.fields.includes(s),onCheckedChange:()=>Ge(s)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Oe(a),e.jsx("span",{className:`font-medium ${i?"text-yellow-700":""}`,children:s}),i&&e.jsxs(C,{variant:"secondary",className:"text-xs",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"PK"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(C,{variant:"outline",className:"font-mono text-xs",children:a})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx(je,{checked:r.editable_fields.includes(s),onCheckedChange:()=>He(s),disabled:!r.fields.includes(s)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(W,{value:r.input_types[s]||"text",onValueChange:n=>qe(s,n),disabled:!r.editable_fields.includes(s),children:[e.jsx(X,{className:"w-full",children:e.jsx(ee,{})}),e.jsx(se,{children:Qe().map(n=>e.jsx(ae,{value:n.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon,n.label]})},n.value))})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"flex justify-end",children:i&&e.jsx(C,{variant:"outline",className:"text-xs",children:"PK"})})})]})},s)})})]})]}):h&&!P?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-gray-50",children:[e.jsx(ws,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-600",children:['No columns found for table "',h,'"']})]}):null,e.jsxs(rs,{className:"gap-2 pt-4 border-t",children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>{f(!1),ce(),T(null),p(""),S([]),g({})},children:"Cancel"}),e.jsx(_,{type:"submit",disabled:ne||P,className:"gap-2",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):c?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"Update Table"]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"Add Table"]})})]})]})]})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(Gs,{value:$e,onValueChange:Pe,className:"space-y-6",children:[e.jsxs(Bs,{className:"grid w-full grid-cols-2",children:[e.jsxs(ve,{value:"configured",className:"gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Configured Tables",e.jsx(C,{variant:"secondary",className:"ml-2",children:l.tables?.length||0})]}),e.jsxs(ve,{value:"available",className:"gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Available Tables",e.jsx(C,{variant:"secondary",className:"ml-2",children:u.length})]})]}),e.jsx(Ne,{value:"configured",className:"space-y-6",children:e.jsxs(Y,{children:[e.jsx(xe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(he,{children:"Configured Tables"}),e.jsx(pe,{children:"Tables that have been configured for use in the application"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Search tables...",value:D,onChange:s=>U(s.target.value),className:"pl-9"})]})})]})}),e.jsx(Z,{children:me.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(fs,{children:[e.jsx(js,{children:e.jsxs(fe,{children:[e.jsx(F,{children:"Display Name"}),e.jsx(F,{children:"Table Name"}),e.jsx(F,{children:"Primary Key"}),e.jsx(F,{children:"Fields"}),e.jsx(F,{children:"Status"}),e.jsx(F,{className:"text-right",children:"Actions"})]})}),e.jsx(ys,{children:me.map(s=>e.jsxs(fe,{children:[e.jsx(I,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-blue-600"}),s.name]})}),e.jsx(I,{children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:s.table_name})}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{children:s.primary_key})]})}),e.jsx(I,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.fields.slice(0,3).map(a=>e.jsx(C,{variant:"secondary",className:"text-xs",children:a},a)),s.fields.length>3&&e.jsxs(C,{variant:"outline",className:"text-xs",children:["+",s.fields.length-3," more"]})]})}),e.jsx(I,{children:e.jsx(C,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(I,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{size:"sm",variant:"outline",onClick:()=>oe(s),children:e.jsx(Cs,{className:"w-3 h-3"})}),e.jsx(_,{size:"sm",asChild:!0,children:e.jsx(V,{href:`/product?conn=${l.id}&table=${s.id}`,children:e.jsx(Ts,{className:"w-3 h-3"})})}),e.jsxs(ns,{children:[e.jsx(cs,{asChild:!0,children:e.jsx(_,{size:"sm",variant:"destructive",children:e.jsx(ks,{className:"w-3 h-3"})})}),e.jsxs(os,{children:[e.jsxs(ds,{children:[e.jsx(ms,{children:"Delete Table Configuration"}),e.jsx(us,{children:"This will delete the table configuration but won't affect the actual database table."})]}),e.jsxs(xs,{children:[e.jsx(hs,{children:"Cancel"}),e.jsx(ps,{onClick:()=>s.id&&Ve(s.id),className:"bg-red-600",children:"Delete"})]})]})]})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(H,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tables configured"}),e.jsxs(_,{onClick:()=>f(!0),className:"gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Your First Table"]})]})})]})}),e.jsx(Ne,{value:"available",children:e.jsxs(Y,{children:[e.jsx(xe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(he,{children:"Available Database Tables"}),e.jsx(pe,{children:"All tables found in the database"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(L,{placeholder:"Search tables...",value:D,onChange:s=>U(s.target.value),className:"pl-9"})]})})]})}),e.jsx(Z,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:de.filter(s=>s&&s.trim()!=="").map(s=>{const a=l.tables?.some(n=>n.table_name===s),i=l.tables?.find(n=>n.table_name===s);return e.jsx(Y,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded ${a?"bg-green-100":"bg-gray-100"}`,children:e.jsx(M,{className:`w-5 h-5 ${a?"text-green-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s}),i&&e.jsx("p",{className:"text-sm text-gray-600",children:i.name})]})]}),a?e.jsxs(C,{variant:"outline",className:"bg-green-50 text-green-700",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Configured"]}):e.jsx(C,{variant:"outline",children:"Available"})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>i&&oe(i),children:"Edit"}),e.jsx(_,{size:"sm",className:"flex-1",asChild:!0,children:e.jsx(V,{href:`/product?conn=${l.id}&table=${i?.id}`,children:"View"})})]}):e.jsx(_,{size:"sm",className:"flex-1",onClick:()=>{p(s),f(!0),T(null)},children:"Configure"})})]})},s)})})})]})})]})})]})})}export{_a as default};
