import{r as y,u as ge,b as ss,j as e,a as q,L as U}from"./app-DGXHZrET.js";import{t as x,A as as,R as be,S as Ne,D as X}from"./app-layout-Dql5IVxS.js";import{C as K,c as O,a as ve,b as we,d as Ce}from"./card-Cv8tL66e.js";import{D as ke,a as ls,b as _e,c as Te,d as Se,e as De,f as ts}from"./dialog-C6LskDxX.js";import{A as rs,a as is,b as ns,c as cs,d as ds,e as os,f as ms,g as xs,h as hs}from"./alert-dialog-DC4SQvKo.js";import{T as us,a as ps,b as Fe,c as A,d as js,e as $}from"./table-4zO_MtUC.js";import{S as Ee,T as fs,a as ys,b as Ae,c as $e}from"./switch-D8sGGSWS.js";import{I as b}from"./input-Swp7yrj4.js";import{L as N}from"./label-DBVC41B8.js";import{B as d}from"./app-logo-icon-7BszVvf1.js";import{B as f}from"./badge-CoxKmixK.js";import{S as Y,a as ee,b as se,c as ae,d as le}from"./select-WM5803v_.js";import{C as gs}from"./chevron-left-DYaWPLKH.js";import{c as v}from"./index-B3m84JAj.js";import{L as V}from"./loader-circle-Cxhx236L.js";import{P as te}from"./plus-ETX__35k.js";import{S as re}from"./search-CwjfSo0S.js";import{G as P}from"./grid-3x3-DEFDCKDH.js";import{C as Me}from"./circle-alert-BCNKFD3J.js";import{C as ie}from"./check-BfHHevVA.js";import{T as bs}from"./test-tube-DEeOHf8k.js";import{S as Ns}from"./save-CFDqwi_A.js";import{S as vs}from"./square-pen-DlDsFk3-.js";import{E as ws}from"./eye-CYuf5vyK.js";import{T as Cs}from"./trash-2-BuaiP1xy.js";import{C as B}from"./calendar-UrKik5Ta.js";import{M as ks}from"./mail-DMr3mBLC.js";/* empty css            */import"./index-Bvj2GysQ.js";import"./index-Bb28m5l8.js";import"./index-Cqw0yIc8.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Ts=v("Columns2",_s);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],R=v("FileText",Ss);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Fs=v("Globe",Ds);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Le=v("Hash",Es);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ne=v("Key",As);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],ze=v("Server",$s);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ls=v("Shield",Ms);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"m19 5 3-3",key:"yk6iyv"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m12 6 6 6 2.3-2.3a2.4 2.4 0 0 0 0-3.4l-2.6-2.6a2.4 2.4 0 0 0-3.4 0Z",key:"1snsnr"}]],Is=v("Unplug",zs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Hs=v("WifiOff",Ps);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Us=v("Wifi",qs);function Na({connection:i,actualTables:ce,flash:M}){const[Ie,D]=y.useState(!1),[Pe,L]=y.useState(!1),[w,z]=y.useState(""),[C,G]=y.useState([]),[W,Z]=y.useState({}),[j,H]=y.useState(null),[I,de]=y.useState(!1),[He,qe]=y.useState("configured"),[F,Q]=y.useState(""),[oe,me]=y.useState(!1),[k,S]=y.useState("checking"),{data:_,setData:E,put:Ks,processing:xe,errors:h,reset:he}=ge({name:i.name,host:i.host,port:i.port,database:i.database,username:i.username,password:""}),{data:l,setData:o,post:Os,processing:ue,errors:T,reset:pe,clearErrors:Ue}=ge({table_name:"",name:"",primary_key:"",fields:[],editable_fields:[],input_types:{},is_active:!0,order:i.tables?.length||0});y.useEffect(()=>{M?.success&&x.success(M.success),M?.error&&x.error(M.error),J()},[M]);const J=async()=>{try{S("checking"),(await(await fetch(`/api/connection/${i.id}/test`)).json()).success?(S("connected"),x.success("Database connected",{description:`Connected to ${i.database}`})):S("disconnected")}catch(s){S("disconnected"),console.error("Connection test failed:",s)}},{csrf:Ke}=ss().props,Oe=async()=>{me(!0);try{const a=await(await fetch(`/api/connection/${i.id}/test`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Ke},body:JSON.stringify({..._,password:_.password||void 0})})).json();a.success?(x.success("Connection Successful",{description:`Connected to ${a.database||i.database}`}),S("connected")):(x.error("Connection Failed",{description:a.message||"Could not connect to database"}),S("disconnected"))}catch(s){x.error("Connection Error",{description:s.message||"Network error"}),S("disconnected")}finally{me(!1)}},Ve=s=>{s.preventDefault(),q.put(`/connect/${i.id}`,_,{preserveScroll:!0,onSuccess:()=>{x.success("Connection updated successfully"),L(!1),he(),J()},onError:a=>{x.error("Failed to update connection")}})};y.useEffect(()=>{w&&Be(w)},[w]);const Be=async s=>{de(!0);try{const a=await fetch(`/api/connection/${i.id}/tables/${s}/columns`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const t=await a.json();if(console.log("API Response for edit:",t),console.log("Editing table input_types:",j?.input_types),t.error)throw new Error(t.error);if(t.columns&&Array.isArray(t.columns)){const n=t.columns.filter(p=>p&&p.trim()!==""),u={};t.types&&Array.isArray(t.types)?n.forEach((p,r)=>{u[p]=t.types[r]||"varchar"}):n.forEach(p=>{u[p]="varchar"}),G(n),Z(u);let c={};j?.input_types?(c={...j.input_types},n.forEach(p=>{if(!c[p]){const r=(u[p]||"varchar").toLowerCase();let m="text";r.includes("int")||r.includes("decimal")||r.includes("float")||r.includes("double")?m="number":r.includes("date")?m="date":r.includes("datetime")||r.includes("timestamp")?m="datetime-local":r.includes("time")?m="time":r.includes("text")||r.includes("blob")?m="textarea":r.includes("enum")?m="select":(r.includes("set")||r==="tinyint(1)"||r.includes("boolean"))&&(m="checkbox"),c[p]=m}})):n.forEach(p=>{const r=(u[p]||"varchar").toLowerCase();let m="text";r.includes("int")||r.includes("decimal")||r.includes("float")||r.includes("double")?m="number":r.includes("date")?m="date":r.includes("datetime")||r.includes("timestamp")?m="datetime-local":r.includes("time")?m="time":r.includes("text")||r.includes("blob")?m="textarea":r.includes("enum")?m="select":(r.includes("set")||r==="tinyint(1)"||r.includes("boolean"))&&(m="checkbox"),c[p]=m});const g=j?.primary_key||n[0]||"id";console.log("Final input types to set:",c),o({...l,table_name:s,name:j?.name||s,primary_key:j?.primary_key||g,fields:j?.fields||n,editable_fields:j?.editable_fields||n.filter(p=>p!==g),input_types:c})}else throw new Error("No columns found in response")}catch(a){console.error("Failed to fetch columns:",a),x.error("Connection Error",{description:"Could not fetch table structure from database"})}finally{de(!1)}},Re=s=>{if(s.preventDefault(),Ue(),!l.table_name){x.error("Please select a table from the database");return}if(!l.name.trim()){x.error("Display name is required");return}if(!l.primary_key){x.error("Primary key is required");return}if(l.fields.includes(l.primary_key)||o("fields",[l.primary_key,...l.fields.filter(u=>u!==l.primary_key)]),l.fields.length===0){x.error("At least one field must be selected");return}const a={...l.input_types};l.fields.forEach(u=>{if(!a[u]){const c=W[u]||"varchar";let g="text";c.includes("int")||c.includes("decimal")||c.includes("float")||c.includes("double")?g="number":c.includes("date")?g="date":c.includes("datetime")||c.includes("timestamp")?g="datetime-local":c.includes("time")?g="time":c.includes("text")||c.includes("blob")?g="textarea":c.includes("enum")?g="select":(c.includes("set")||c==="tinyint(1)"||c.includes("boolean"))&&(g="checkbox"),a[u]=g}}),o("input_types",a);const t=`/connect/${i.id}/tables`;q[j?"put":"post"](t,{...l,input_types:a,id:j?.id},{preserveScroll:!0,onSuccess:()=>{pe(),D(!1),z(""),H(null),G([]),Z({})},onError:u=>{console.error("Form errors:",u),x.error("Please check your form for errors")}})},je=async s=>{console.log("Editing table:",s),console.log("Table input_types:",s.input_types),H(s),D(!0),z(s.table_name),o({table_name:s.table_name,name:s.name,primary_key:s.primary_key,fields:s.fields,editable_fields:s.editable_fields||[],input_types:s.input_types||{},is_active:s.is_active,order:s.order})},Ge=s=>{q.delete(`/connect/${i.id}/tables/${s}`,{preserveScroll:!0,onSuccess:()=>{x.success("Table configuration deleted")},onError:()=>{x.error("Could not delete the table configuration")}})},We=s=>{const a=l.editable_fields.includes(s)?l.editable_fields.filter(t=>t!==s):[...l.editable_fields,s];o("editable_fields",a)},Ze=(s,a)=>{o("input_types",{...l.input_types,[s]:a})},Qe=()=>{const s=[l.primary_key].filter(t=>C.includes(t)&&t&&t.trim()!=="");o("fields",s),o("editable_fields",[]);const a={};l.primary_key&&(a[l.primary_key]=l.input_types[l.primary_key]||"text"),o("input_types",a)},Je=s=>{const a=l.fields.includes(s)?l.fields.filter(t=>t!==s):[...l.fields,s];if(o("fields",a),!a.includes(s)){const t=l.editable_fields.filter(u=>u!==s);o("editable_fields",t);const n={...l.input_types};delete n[s],o("input_types",n)}},Xe=()=>{o("fields",C),o("editable_fields",C.filter(s=>s!==l.primary_key))},Ye=s=>{const a=s.toLowerCase();return a.includes("int")||a.includes("decimal")||a.includes("float")?e.jsx(Le,{className:"w-4 h-4"}):a.includes("date")||a.includes("time")?e.jsx(B,{className:"w-4 h-4"}):a.includes("text")||a.includes("blob")?e.jsx(R,{className:"w-4 h-4"}):a.includes("enum")||a.includes("set")?e.jsx(P,{className:"w-4 h-4"}):a.includes("char")||a.includes("varchar")?e.jsx(U,{className:"w-4 h-4"}):e.jsx(R,{className:"w-4 h-4"})},es=()=>[{value:"text",label:"Text",icon:e.jsx(R,{className:"w-4 h-4"})},{value:"number",label:"Number",icon:e.jsx(Le,{className:"w-4 h-4"})},{value:"email",label:"Email",icon:e.jsx(ks,{className:"w-4 h-4"})},{value:"date",label:"Date",icon:e.jsx(B,{className:"w-4 h-4"})},{value:"datetime-local",label:"Date Time",icon:e.jsx(B,{className:"w-4 h-4"})},{value:"time",label:"Time",icon:e.jsx(B,{className:"w-4 h-4"})},{value:"textarea",label:"Text Area",icon:e.jsx(R,{className:"w-4 h-4"})},{value:"select",label:"Dropdown",icon:e.jsx(P,{className:"w-4 h-4"})},{value:"checkbox",label:"Checkbox",icon:e.jsx(ie,{className:"w-4 h-4"})},{value:"password",label:"Password",icon:e.jsx(Ls,{className:"w-4 h-4"})},{value:"url",label:"URL",icon:e.jsx(U,{className:"w-4 h-4"})}],fe=ce.filter(s=>s.toLowerCase().includes(F.toLowerCase())),ye=i.tables?.filter(s=>s.name.toLowerCase().includes(F.toLowerCase())||s.table_name.toLowerCase().includes(F.toLowerCase()))||[];return e.jsx(as,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"border-b bg-white dark:bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>q.visit("/connect"),className:"gap-2",children:[e.jsx(gs,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${k==="connected"?"bg-green-100":k==="disconnected"?"bg-red-100":"bg-yellow-100"}`,children:k==="connected"?e.jsx(Us,{className:"w-6 h-6 text-green-600"}):k==="disconnected"?e.jsx(Hs,{className:"w-6 h-6 text-red-600"}):e.jsx(V,{className:"w-6 h-6 text-yellow-600 animate-spin"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Table Management"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Fs,{className:"w-3 h-3 mr-1"}),i.host,":",i.port]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-medium",children:i.database}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i.name}),e.jsx("span",{children:"•"}),e.jsx(f,{variant:k==="connected"?"default":k==="disconnected"?"destructive":"outline",className:"text-xs",children:k==="connected"?"Connected":k==="disconnected"?"Disconnected":"Checking..."})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(d,{variant:"outline",onClick:J,className:"gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Check Connection"]}),e.jsxs(d,{variant:"outline",onClick:()=>L(!0),className:"gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Edit Connection"]}),e.jsxs(ke,{open:Ie,onOpenChange:D,children:[e.jsx(ls,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Add Table"]})}),e.jsxs(_e,{className:"w-full min-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Te,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),j?`Edit Table: ${j.name}`:"Configure New Table"]}),e.jsx(De,{children:"Configure how this database table should be displayed and managed in the application"})]}),e.jsxs("form",{onSubmit:Re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{htmlFor:"table_name",children:"Database Table *"}),e.jsxs(Y,{value:w,onValueChange:z,disabled:!!j,children:[e.jsx(ee,{className:`${T.table_name?"border-red-500":""}`,children:e.jsx(se,{placeholder:"Select a table from database",children:w||"Select a table"})}),e.jsxs(ae,{children:[e.jsx("div",{className:"p-2 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{placeholder:"Search tables...",value:F,onChange:s=>Q(s.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:fe.filter(s=>s&&s.trim()!=="").map(s=>{const a=i.tables?.some(t=>t.table_name===s);return e.jsx(le,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:s})]}),a&&e.jsx(f,{variant:"outline",className:"text-xs",children:"Configured"})]})},s)})})]})]}),T.table_name&&e.jsx("p",{className:"text-red-500 text-sm",children:T.table_name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{htmlFor:"name",children:"Display Name *"}),e.jsx(b,{id:"name",value:l.name,onChange:s=>o("name",s.target.value),placeholder:"e.g., Products Inventory",className:T.name?"border-red-500":"",required:!0}),T.name&&e.jsx("p",{className:"text-red-500 text-sm",children:T.name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{htmlFor:"primary_key",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Primary Key *"]}),e.jsxs(Y,{value:l.primary_key,onValueChange:s=>o("primary_key",s),disabled:I||C.length===0,children:[e.jsx(ee,{className:`${T.primary_key?"border-red-500":""}`,children:e.jsx(se,{placeholder:I?"Loading...":C.length===0?"No columns":"Select primary key"})}),e.jsx(ae,{children:C.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(le,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(f,{variant:"outline",className:"ml-2 text-xs font-mono",children:W[s]||"varchar"})]})},s))})]}),T.primary_key&&e.jsx("p",{className:"text-red-500 text-sm",children:T.primary_key})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{htmlFor:"order",children:"Display Order"}),e.jsx(b,{id:"order",type:"number",value:l.order,onChange:s=>o("order",parseInt(s.target.value)||0),placeholder:"0"})]})]})]}),I?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(be,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Loading table structure..."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fetching columns from ",w]})]})]}):C.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ts,{className:"w-5 h-5"}),"Column Configuration",e.jsxs(f,{variant:"outline",className:"ml-2",children:[C.length," columns"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:Xe,children:"Select All"}),e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:Qe,children:"Deselect All"})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-black px-4 py-3 border-b",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-1 text-center",children:"Show"}),e.jsx("div",{className:"col-span-3",children:"Column"}),e.jsx("div",{className:"col-span-2",children:"Type"}),e.jsx("div",{className:"col-span-2 text-center",children:"Editable"}),e.jsx("div",{className:"col-span-3",children:"Input Type"}),e.jsx("div",{className:"col-span-1",children:"Properties"})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:C.filter(s=>s&&s.trim()!=="").map(s=>{const a=W[s]||"varchar",t=s===l.primary_key;return e.jsx("div",{className:`px-4 py-3 border-b hover:bg-gray-50 dark:bg-black ${t?"bg-yellow-50":""}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(Ee,{checked:l.fields.includes(s),onCheckedChange:()=>Je(s)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Ye(a),e.jsx("span",{className:`font-medium ${t?"text-yellow-700":""}`,children:s}),t&&e.jsxs(f,{variant:"secondary",className:"text-xs",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"PK"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(f,{variant:"outline",className:"font-mono text-xs",children:a})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx(Ee,{checked:l.editable_fields.includes(s),onCheckedChange:()=>We(s),disabled:!l.fields.includes(s)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(Y,{value:l.input_types[s]||"text",onValueChange:n=>Ze(s,n),disabled:!l.editable_fields.includes(s),children:[e.jsx(ee,{className:"w-full",children:e.jsx(se,{})}),e.jsx(ae,{children:es().map(n=>e.jsx(le,{value:n.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon,n.label]})},n.value))})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"flex justify-end",children:t&&e.jsx(f,{variant:"outline",className:"text-xs",children:"PK"})})})]})},s)})})]})]}):w&&!I?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-gray-50 dark:bg-black",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-600",children:['No columns found for table "',w,'"']})]}):null,e.jsxs(ts,{className:"gap-2 pt-4 border-t",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{D(!1),pe(),H(null),z(""),G([]),Z({})},children:"Cancel"}),e.jsx(d,{type:"submit",disabled:ue||I,className:"gap-2",children:ue?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):j?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4"}),"Update Table"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Add Table"]})})]})]})]})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[k==="disconnected"&&e.jsx("div",{className:"mb-6",children:e.jsx(K,{className:"border-red-200 bg-red-50",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800",children:"Database Connection Error"}),e.jsxs("p",{className:"text-sm text-red-700",children:["Cannot connect to ",i.database," at ",i.host,":",i.port]})]})]}),e.jsxs(d,{variant:"destructive",onClick:()=>L(!0),className:"gap-2",children:[e.jsx(Is,{className:"w-4 h-4"}),"Fix Connection"]})]})})})}),e.jsx(ke,{open:Pe,onOpenChange:L,children:e.jsxs(_e,{className:"max-w-2xl",children:[e.jsxs(Te,{children:[e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),"Edit Database Connection"]}),e.jsx(De,{children:"Update your database connection settings"})]}),e.jsxs("form",{onSubmit:Ve,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Connection Name *"}),e.jsx(b,{id:"name",value:_.name,onChange:s=>E("name",s.target.value),placeholder:"My Inventory Database",className:h.name?"border-red-500":""}),h.name&&e.jsx("p",{className:"text-red-500 text-sm",children:h.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"host",children:"Host *"}),e.jsx(b,{id:"host",value:_.host,onChange:s=>E("host",s.target.value),placeholder:"127.0.0.1",className:h.host?"border-red-500":""}),h.host&&e.jsx("p",{className:"text-red-500 text-sm",children:h.host})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"port",children:"Port *"}),e.jsx(b,{id:"port",type:"number",value:_.port,onChange:s=>E("port",parseInt(s.target.value)||3306),className:h.port?"border-red-500":""}),h.port&&e.jsx("p",{className:"text-red-500 text-sm",children:h.port})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"database",children:"Database Name *"}),e.jsx(b,{id:"database",value:_.database,onChange:s=>E("database",s.target.value),className:h.database?"border-red-500":""}),h.database&&e.jsx("p",{className:"text-red-500 text-sm",children:h.database})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"username",children:"Username *"}),e.jsx(b,{id:"username",value:_.username,onChange:s=>E("username",s.target.value),className:h.username?"border-red-500":""}),h.username&&e.jsx("p",{className:"text-red-500 text-sm",children:h.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password (leave blank to keep current)"}),e.jsx(b,{id:"password",type:"password",value:_.password,onChange:s=>E("password",s.target.value),placeholder:"••••••••"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs(d,{type:"button",variant:"outline",onClick:Oe,disabled:oe,className:"gap-2",children:[oe?e.jsx(V,{className:"w-4 h-4 animate-spin"}):e.jsx(bs,{className:"w-4 h-4"}),"Test Connection"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{L(!1),he()},children:"Cancel"}),e.jsx(d,{type:"submit",disabled:xe,className:"gap-2",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-4 h-4"}),"Update Connection"]})})]})]})]})]})}),e.jsxs(fs,{value:He,onValueChange:qe,className:"space-y-6",children:[e.jsxs(ys,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ae,{value:"configured",className:"gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Configured Tables",e.jsx(f,{variant:"secondary",className:"ml-2",children:i.tables?.length||0})]}),e.jsxs(Ae,{value:"available",className:"gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Available Tables",e.jsx(f,{variant:"secondary",className:"ml-2",children:ce.length})]})]}),e.jsx($e,{value:"configured",className:"space-y-6",children:e.jsxs(K,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(we,{children:"Configured Tables"}),e.jsx(Ce,{children:"Tables that have been configured for use in the application"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{placeholder:"Search tables...",value:F,onChange:s=>Q(s.target.value),className:"pl-9"})]})})]})}),e.jsx(O,{children:ye.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(us,{children:[e.jsx(ps,{children:e.jsxs(Fe,{children:[e.jsx(A,{children:"Display Name"}),e.jsx(A,{children:"Table Name"}),e.jsx(A,{children:"Primary Key"}),e.jsx(A,{children:"Fields"}),e.jsx(A,{children:"Status"}),e.jsx(A,{className:"text-right",children:"Actions"})]})}),e.jsx(js,{children:ye.map(s=>e.jsxs(Fe,{children:[e.jsx($,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-blue-600"}),s.name]})}),e.jsx($,{children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:s.table_name})}),e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{children:s.primary_key})]})}),e.jsx($,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.fields.slice(0,3).map(a=>e.jsx(f,{variant:"secondary",className:"text-xs",children:a},a)),s.fields.length>3&&e.jsxs(f,{variant:"outline",className:"text-xs",children:["+",s.fields.length-3," more"]})]})}),e.jsx($,{children:e.jsx(f,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx($,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>je(s),children:e.jsx(vs,{className:"w-3 h-3"})}),e.jsx(d,{size:"sm",asChild:!0,children:e.jsx(U,{href:`/product?conn=${i.id}&table=${s.id}`,children:e.jsx(ws,{className:"w-3 h-3"})})}),e.jsxs(rs,{children:[e.jsx(is,{asChild:!0,children:e.jsx(d,{size:"sm",variant:"destructive",children:e.jsx(Cs,{className:"w-3 h-3"})})}),e.jsxs(ns,{children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Delete Table Configuration"}),e.jsx(os,{children:"This will delete the table configuration but won't affect the actual database table."})]}),e.jsxs(ms,{children:[e.jsx(xs,{children:"Cancel"}),e.jsx(hs,{onClick:()=>s.id&&Ge(s.id),className:"bg-red-600",children:"Delete"})]})]})]})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(X,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tables configured"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add your first table to start managing data"}),e.jsxs(d,{onClick:()=>D(!0),className:"gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Add Your First Table"]})]})})]})}),e.jsx($e,{value:"available",children:e.jsxs(K,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(we,{children:"Available Database Tables"}),e.jsx(Ce,{children:"All tables found in the database"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(b,{placeholder:"Search tables...",value:F,onChange:s=>Q(s.target.value),className:"pl-9"})]})})]})}),e.jsx(O,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:fe.filter(s=>s&&s.trim()!=="").map(s=>{const a=i.tables?.some(n=>n.table_name===s),t=i.tables?.find(n=>n.table_name===s);return e.jsx(K,{children:e.jsxs(O,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded ${a?"bg-green-100":"bg-gray-100 dark:bg-gray-800"}`,children:e.jsx(P,{className:`w-5 h-5 ${a?"text-green-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s}),t&&e.jsx("p",{className:"text-sm text-gray-600",children:t.name})]})]}),a?e.jsxs(f,{variant:"outline",className:"bg-green-50 text-green-700",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"Configured"]}):e.jsx(f,{variant:"outline",children:"Available"})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>t&&je(t),children:"Edit"}),e.jsx(d,{size:"sm",className:"flex-1",asChild:!0,children:e.jsx(U,{href:`/product?conn=${i.id}&table=${t?.id}`,children:"View"})})]}):e.jsx(d,{size:"sm",className:"flex-1",onClick:()=>{z(s),D(!0),H(null)},children:"Configure"})})]})},s)})})})]})})]})]})]})})}export{Na as default};
