import{r as g,j as e,u as ts,a as G,L as K}from"./app-AyFvkLHt.js";import{u as ls,a as rs,c as ke,R as is,I as ns,A as cs,S as pe}from"./app-layout-PBchuoGo.js";import{C as J,a as fe,b as je,d as be,c as ee}from"./card-DNNRQXi0.js";import{D as os,a as ds,b as ms,c as us,d as hs,e as xs,f as ps}from"./dialog-CUvgz1DT.js";import{S as se,A as fs,a as js,T as bs,b as gs,c as ys,d as vs,e as Ns,f as ws,g as Cs,h as _s}from"./alert-dialog-Ds2lKRAk.js";import{T as ks,a as Ts,b as ge,c as $,d as Ss,e as M,S as As}from"./table-B98rsF49.js";import{u as Te,c as Se,a as X,P as Es,b as Ds}from"./index-R3WdzqYN.js";import{P as R}from"./index-fdDaLK-D.js";import{c as I,a as L,u as Ae,B as C}from"./app-logo-icon-BK4IrVPS.js";import{I as B}from"./input-C_JYf3hS.js";import{L as O}from"./label-B37TrHeA.js";import{B as _}from"./badge-DoPJFvVb.js";import{S as ae,a as te,b as le,c as re,d as ie}from"./select-lit_ok_P.js";import{u as Ps}from"./index-DQM44TCQ.js";import{t as A,C as Is,D as U,G as V}from"./index-BBHJi-10.js";import{R as ye}from"./refresh-cw-CaQpniRf.js";import{C as Fs}from"./circle-alert-CF9C0wI8.js";import{L as $s}from"./loader-circle-BFyGOdhE.js";import{C as ne}from"./check-BBWKwXqn.js";import{P as ve}from"./plus-DTBZiQy2.js";import{E as Ms}from"./eye-CJWeJsAW.js";/* empty css            */import"./index-CSpiwRm-.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Q=I("Calendar",Ls);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],zs=I("Columns2",Rs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],W=I("FileText",Hs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Vs=I("Globe",Bs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ne=I("Hash",qs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ce=I("Key",Gs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],Os=I("Mail",Ks);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Qs=I("Shield",Us);var Y="Tabs",[Ws,Ia]=Se(Y,[ke]),Ee=ke(),[Xs,oe]=Ws(Y),De=g.forwardRef((a,o)=>{const{__scopeTabs:x,value:j,onValueChange:m,defaultValue:p,orientation:u="horizontal",dir:f,activationMode:v="automatic",...k}=a,b=ls(f),[i,N]=Te({prop:j,onChange:m,defaultProp:p??"",caller:Y});return e.jsx(Xs,{scope:x,baseId:rs(),value:i,onValueChange:N,orientation:u,dir:b,activationMode:v,children:e.jsx(R.div,{dir:b,"data-orientation":u,...k,ref:o})})});De.displayName=Y;var Pe="TabsList",Ie=g.forwardRef((a,o)=>{const{__scopeTabs:x,loop:j=!0,...m}=a,p=oe(Pe,x),u=Ee(x);return e.jsx(is,{asChild:!0,...u,orientation:p.orientation,dir:p.dir,loop:j,children:e.jsx(R.div,{role:"tablist","aria-orientation":p.orientation,...m,ref:o})})});Ie.displayName=Pe;var Fe="TabsTrigger",$e=g.forwardRef((a,o)=>{const{__scopeTabs:x,value:j,disabled:m=!1,...p}=a,u=oe(Fe,x),f=Ee(x),v=Re(u.baseId,j),k=ze(u.baseId,j),b=j===u.value;return e.jsx(ns,{asChild:!0,...f,focusable:!m,active:b,children:e.jsx(R.button,{type:"button",role:"tab","aria-selected":b,"aria-controls":k,"data-state":b?"active":"inactive","data-disabled":m?"":void 0,disabled:m,id:v,...p,ref:o,onMouseDown:X(a.onMouseDown,i=>{!m&&i.button===0&&i.ctrlKey===!1?u.onValueChange(j):i.preventDefault()}),onKeyDown:X(a.onKeyDown,i=>{[" ","Enter"].includes(i.key)&&u.onValueChange(j)}),onFocus:X(a.onFocus,()=>{const i=u.activationMode!=="manual";!b&&!m&&i&&u.onValueChange(j)})})})});$e.displayName=Fe;var Me="TabsContent",Le=g.forwardRef((a,o)=>{const{__scopeTabs:x,value:j,forceMount:m,children:p,...u}=a,f=oe(Me,x),v=Re(f.baseId,j),k=ze(f.baseId,j),b=j===f.value,i=g.useRef(b);return g.useEffect(()=>{const N=requestAnimationFrame(()=>i.current=!1);return()=>cancelAnimationFrame(N)},[]),e.jsx(Es,{present:m||b,children:({present:N})=>e.jsx(R.div,{"data-state":b?"active":"inactive","data-orientation":f.orientation,role:"tabpanel","aria-labelledby":v,hidden:!N,id:k,tabIndex:0,...u,ref:o,style:{...a.style,animationDuration:i.current?"0s":void 0},children:N&&p})})});Le.displayName=Me;function Re(a,o){return`${a}-trigger-${o}`}function ze(a,o){return`${a}-content-${o}`}var Ys=De,Zs=Ie,Js=$e,ea=Le;function sa({className:a,...o}){return e.jsx(Ys,{"data-slot":"tabs",className:L("flex flex-col gap-2",a),...o})}function aa({className:a,...o}){return e.jsx(Zs,{"data-slot":"tabs-list",className:L("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",a),...o})}function we({className:a,...o}){return e.jsx(Js,{"data-slot":"tabs-trigger",className:L("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...o})}function Ce({className:a,...o}){return e.jsx(ea,{"data-slot":"tabs-content",className:L("flex-1 outline-none",a),...o})}var Z="Switch",[ta,Fa]=Se(Z),[la,ra]=ta(Z),He=g.forwardRef((a,o)=>{const{__scopeSwitch:x,name:j,checked:m,defaultChecked:p,required:u,disabled:f,value:v="on",onCheckedChange:k,form:b,...i}=a,[N,E]=g.useState(null),P=Ae(o,c=>E(c)),z=g.useRef(!1),q=N?b||!!N.closest("form"):!0,[T,H]=Te({prop:m,defaultProp:p??!1,onChange:k,caller:Z});return e.jsxs(la,{scope:x,checked:T,disabled:f,children:[e.jsx(R.button,{type:"button",role:"switch","aria-checked":T,"aria-required":u,"data-state":Ge(T),"data-disabled":f?"":void 0,disabled:f,value:v,...i,ref:P,onClick:X(a.onClick,c=>{H(y=>!y),q&&(z.current=c.isPropagationStopped(),z.current||c.stopPropagation())})}),q&&e.jsx(qe,{control:N,bubbles:!z.current,name:j,value:v,checked:T,required:u,disabled:f,form:b,style:{transform:"translateX(-100%)"}})]})});He.displayName=Z;var Be="SwitchThumb",Ve=g.forwardRef((a,o)=>{const{__scopeSwitch:x,...j}=a,m=ra(Be,x);return e.jsx(R.span,{"data-state":Ge(m.checked),"data-disabled":m.disabled?"":void 0,...j,ref:o})});Ve.displayName=Be;var ia="SwitchBubbleInput",qe=g.forwardRef(({__scopeSwitch:a,control:o,checked:x,bubbles:j=!0,...m},p)=>{const u=g.useRef(null),f=Ae(u,p),v=Ps(x),k=Ds(o);return g.useEffect(()=>{const b=u.current;if(!b)return;const i=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(i,"checked").set;if(v!==x&&E){const P=new Event("click",{bubbles:j});E.call(b,x),b.dispatchEvent(P)}},[v,x,j]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:x,...m,tabIndex:-1,ref:f,style:{...m.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});qe.displayName=ia;function Ge(a){return a?"checked":"unchecked"}var na=He,ca=Ve;function _e({className:a,...o}){return e.jsx(na,{"data-slot":"switch",className:L("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...o,children:e.jsx(ca,{"data-slot":"switch-thumb",className:L("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function $a({connection:a,actualTables:o,flash:x}){const[j,m]=g.useState(!1),[p,u]=g.useState(""),[f,v]=g.useState([]),[k,b]=g.useState({}),[i,N]=g.useState(null),[E,P]=g.useState(!1),[z,q]=g.useState("configured"),[T,H]=g.useState(""),{data:c,setData:y,post:oa,processing:de,errors:D,reset:me,clearErrors:Ke}=ts({table_name:"",name:"",primary_key:"",fields:[],editable_fields:[],input_types:{},is_active:!0,order:a.tables?.length||0});g.useEffect(()=>{x?.success&&A.success(x.success),x?.error&&A.error(x.error)},[x]),g.useEffect(()=>{p&&p!==i?.table_name&&Oe(p)},[p]);const Oe=async s=>{P(!0);try{const l=await fetch(`/api/connection/${a.id}/tables/${s}/columns`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const r=await l.json();if(console.log("API Response for edit:",r),console.log("Editing table input_types:",i?.input_types),r.error)throw new Error(r.error);if(r.columns&&Array.isArray(r.columns)){const n=r.columns.filter(d=>d&&d.trim()!==""),w={};r.types&&Array.isArray(r.types)?n.forEach((d,t)=>{w[d]=r.types[t]||"varchar"}):n.forEach(d=>{w[d]="varchar"}),v(n),b(w);let S={};i?.input_types?(S={...i.input_types},n.forEach(d=>{if(!S[d]){const t=(w[d]||"varchar").toLowerCase();let h="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?h="number":t.includes("date")?h="date":t.includes("datetime")||t.includes("timestamp")?h="datetime-local":t.includes("time")?h="time":t.includes("text")||t.includes("blob")?h="textarea":t.includes("enum")?h="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(h="checkbox"),S[d]=h}})):n.forEach(d=>{const t=(w[d]||"varchar").toLowerCase();let h="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?h="number":t.includes("date")?h="date":t.includes("datetime")||t.includes("timestamp")?h="datetime-local":t.includes("time")?h="time":t.includes("text")||t.includes("blob")?h="textarea":t.includes("enum")?h="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(h="checkbox"),S[d]=h});const F=i?.primary_key||n[0]||"id";console.log("Final input types to set:",S),y({...c,table_name:s,name:i?.name||s,primary_key:i?.primary_key||F,fields:i?.fields||n,editable_fields:i?.editable_fields||n.filter(d=>d!==F),input_types:S})}else throw new Error("No columns found in response")}catch(l){console.error("Failed to fetch columns:",l),A.error("Connection Error",{description:"Could not fetch table structure from database"})}finally{P(!1)}},Ue=s=>{if(s.preventDefault(),Ke(),!c.table_name){A.error("Please select a table from the database");return}if(!c.name.trim()){A.error("Display name is required");return}if(!c.primary_key){A.error("Primary key is required");return}if(c.fields.length===0){A.error("At least one field must be selected");return}const l=`/connect/${a.id}/tables`;G[i?"put":"post"](l,{...c,id:i?.id},{preserveScroll:!0,onSuccess:()=>{me(),m(!1),u(""),N(null),v([]),b({})},onError:()=>{A.error("Please check your form for errors")}})},ue=async s=>{console.log("Editing table:",s),console.log("Table input_types:",s.input_types),N(s),m(!0),u(s.table_name),y({table_name:s.table_name,name:s.name,primary_key:s.primary_key,fields:s.fields,editable_fields:s.editable_fields||[],input_types:s.input_types||{},is_active:s.is_active,order:s.order}),await Qe(s.table_name,s.input_types||{})},Qe=async(s,l)=>{P(!0);try{const r=await fetch(`/api/connection/${a.id}/tables/${s}/columns`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if(console.log("API Response for edit:",n),console.log("Saved input_types:",l),n.error)throw new Error(n.error);if(n.columns&&Array.isArray(n.columns)){const w=n.columns.filter(d=>d&&d.trim()!==""),S={};n.types&&Array.isArray(n.types)?w.forEach((d,t)=>{S[d]=n.types[t]||"varchar"}):w.forEach(d=>{S[d]="varchar"}),v(w),b(S);const F={...l};w.forEach(d=>{if(!F[d]){const t=(S[d]||"varchar").toLowerCase();let h="text";t.includes("int")||t.includes("decimal")||t.includes("float")||t.includes("double")?h="number":t.includes("date")?h="date":t.includes("datetime")||t.includes("timestamp")?h="datetime-local":t.includes("time")?h="time":t.includes("text")||t.includes("blob")?h="textarea":t.includes("enum")?h="select":(t.includes("set")||t==="tinyint(1)"||t.includes("boolean"))&&(h="checkbox"),F[d]=h}}),console.log("Final input types to set:",F),y(d=>({...d,fields:w,input_types:F}))}}catch(r){console.error("Failed to fetch columns:",r),A.error("Connection Error",{description:"Could not fetch table structure from database"})}finally{P(!1)}},We=s=>{G.delete(`/connect/${a.id}/tables/${s}`,{preserveScroll:!0,onSuccess:()=>{A.success("Table configuration deleted")},onError:()=>{A.error("Could not delete the table configuration")}})},Xe=s=>{const l=c.editable_fields.includes(s)?c.editable_fields.filter(r=>r!==s):[...c.editable_fields,s];y("editable_fields",l)},Ye=(s,l)=>{y("input_types",{...c.input_types,[s]:l})},Ze=s=>{const l=c.fields.includes(s)?c.fields.filter(r=>r!==s):[...c.fields,s];if(y("fields",l),!l.includes(s)){const r=c.editable_fields.filter(w=>w!==s);y("editable_fields",r);const n={...c.input_types};delete n[s],y("input_types",n)}},Je=()=>{y("fields",f),y("editable_fields",f.filter(s=>s!==c.primary_key))},es=()=>{y("fields",[c.primary_key]),y("editable_fields",[])},ss=s=>{const l=s.toLowerCase();return l.includes("int")||l.includes("decimal")||l.includes("float")?e.jsx(Ne,{className:"w-4 h-4"}):l.includes("date")||l.includes("time")?e.jsx(Q,{className:"w-4 h-4"}):l.includes("text")||l.includes("blob")?e.jsx(W,{className:"w-4 h-4"}):l.includes("enum")||l.includes("set")?e.jsx(V,{className:"w-4 h-4"}):l.includes("char")||l.includes("varchar")?e.jsx(K,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"})},as=()=>[{value:"text",label:"Text",icon:e.jsx(W,{className:"w-4 h-4"})},{value:"number",label:"Number",icon:e.jsx(Ne,{className:"w-4 h-4"})},{value:"email",label:"Email",icon:e.jsx(Os,{className:"w-4 h-4"})},{value:"date",label:"Date",icon:e.jsx(Q,{className:"w-4 h-4"})},{value:"datetime-local",label:"Date Time",icon:e.jsx(Q,{className:"w-4 h-4"})},{value:"time",label:"Time",icon:e.jsx(Q,{className:"w-4 h-4"})},{value:"textarea",label:"Text Area",icon:e.jsx(W,{className:"w-4 h-4"})},{value:"select",label:"Dropdown",icon:e.jsx(V,{className:"w-4 h-4"})},{value:"checkbox",label:"Checkbox",icon:e.jsx(ne,{className:"w-4 h-4"})},{value:"password",label:"Password",icon:e.jsx(Qs,{className:"w-4 h-4"})},{value:"url",label:"URL",icon:e.jsx(K,{className:"w-4 h-4"})}],he=o.filter(s=>s.toLowerCase().includes(T.toLowerCase())),xe=a.tables?.filter(s=>s.name.toLowerCase().includes(T.toLowerCase())||s.table_name.toLowerCase().includes(T.toLowerCase()))||[];return e.jsx(cs,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"border-b bg-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>G.visit("/connect"),className:"gap-2",children:[e.jsx(Is,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Table Management"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Vs,{className:"w-3 h-3 mr-1"}),a.host,":",a.port]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-medium",children:a.database}),e.jsx("span",{children:"•"}),e.jsx("span",{children:a.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(C,{variant:"outline",onClick:()=>G.reload({preserveScroll:!0}),className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs(os,{open:j,onOpenChange:m,children:[e.jsx(ds,{asChild:!0}),e.jsxs(ms,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(us,{children:[e.jsxs(hs,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),i?`Edit Table: ${i.name}`:"Configure New Table"]}),e.jsx(xs,{children:"Configure how this database table should be displayed and managed in the application"})]}),e.jsxs("form",{onSubmit:Ue,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{htmlFor:"table_name",children:"Database Table *"}),e.jsxs(ae,{value:p,onValueChange:u,disabled:!!i,children:[e.jsx(te,{className:`${D.table_name?"border-red-500":""}`,children:e.jsx(le,{placeholder:"Select a table from database",children:p||"Select a table"})}),e.jsxs(re,{children:[e.jsx("div",{className:"p-2 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Search tables...",value:T,onChange:s=>H(s.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:he.filter(s=>s&&s.trim()!=="").map(s=>{const l=a.tables?.some(r=>r.table_name===s);return e.jsx(ie,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:s})]}),l&&e.jsx(_,{variant:"outline",className:"text-xs",children:"Configured"})]})},s)})})]})]}),D.table_name&&e.jsx("p",{className:"text-red-500 text-sm",children:D.table_name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{htmlFor:"name",children:"Display Name *"}),e.jsx(B,{id:"name",value:c.name,onChange:s=>y("name",s.target.value),placeholder:"e.g., Products Inventory",className:D.name?"border-red-500":"",required:!0}),D.name&&e.jsx("p",{className:"text-red-500 text-sm",children:D.name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(O,{htmlFor:"primary_key",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Primary Key *"]}),e.jsxs(ae,{value:c.primary_key,onValueChange:s=>y("primary_key",s),disabled:E||f.length===0,children:[e.jsx(te,{className:`${D.primary_key?"border-red-500":""}`,children:e.jsx(le,{placeholder:E?"Loading...":f.length===0?"No columns":"Select primary key"})}),e.jsx(re,{children:f.filter(s=>s&&s.trim()!=="").map(s=>e.jsx(ie,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(_,{variant:"outline",className:"ml-2 text-xs font-mono",children:k[s]||"varchar"})]})},s))})]}),D.primary_key&&e.jsx("p",{className:"text-red-500 text-sm",children:D.primary_key})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{htmlFor:"order",children:"Display Order"}),e.jsx(B,{id:"order",type:"number",value:c.order,onChange:s=>y("order",parseInt(s.target.value)||0),placeholder:"0"})]})]})]}),E?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(ye,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Loading table structure..."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fetching columns from ",p]})]})]}):f.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5"}),"Column Configuration",e.jsxs(_,{variant:"outline",className:"ml-2",children:[f.length," columns"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"button",variant:"outline",size:"sm",onClick:Je,children:"Select All"}),e.jsx(C,{type:"button",variant:"outline",size:"sm",onClick:es,children:"Deselect All"})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-1 text-center",children:"Show"}),e.jsx("div",{className:"col-span-3",children:"Column"}),e.jsx("div",{className:"col-span-2",children:"Type"}),e.jsx("div",{className:"col-span-2 text-center",children:"Editable"}),e.jsx("div",{className:"col-span-3",children:"Input Type"}),e.jsx("div",{className:"col-span-1",children:"Properties"})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:f.filter(s=>s&&s.trim()!=="").map(s=>{const l=k[s]||"varchar",r=s===c.primary_key;return e.jsx("div",{className:`px-4 py-3 border-b hover:bg-gray-50 ${r?"bg-yellow-50":""}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1 text-center",children:e.jsx(_e,{checked:c.fields.includes(s),onCheckedChange:()=>Ze(s),disabled:r})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ss(l),e.jsx("span",{className:`font-medium ${r?"text-yellow-700":""}`,children:s}),r&&e.jsxs(_,{variant:"secondary",className:"text-xs",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"PK"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(_,{variant:"outline",className:"font-mono text-xs",children:l})}),e.jsx("div",{className:"col-span-2 text-center",children:e.jsx(_e,{checked:c.editable_fields.includes(s),onCheckedChange:()=>Xe(s),disabled:!c.fields.includes(s)||r})}),e.jsx("div",{className:"col-span-3",children:e.jsxs(ae,{value:c.input_types[s]||"text",onValueChange:n=>Ye(s,n),disabled:!c.editable_fields.includes(s),children:[e.jsx(te,{className:"w-full",children:e.jsx(le,{})}),e.jsx(re,{children:as().map(n=>e.jsx(ie,{value:n.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[n.icon,n.label]})},n.value))})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("div",{className:"flex justify-end",children:r&&e.jsx(_,{variant:"outline",className:"text-xs",children:"PK"})})})]})},s)})})]})]}):p&&!E?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-gray-50",children:[e.jsx(Fs,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-600",children:['No columns found for table "',p,'"']})]}):null,e.jsxs(ps,{className:"gap-2 pt-4 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>{m(!1),me(),N(null),u(""),v([]),b({})},children:"Cancel"}),e.jsx(C,{type:"submit",disabled:de||E,className:"gap-2",children:de?e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):i?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),"Update Table"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4"}),"Add Table"]})})]})]})]})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(sa,{value:z,onValueChange:q,className:"space-y-6",children:[e.jsxs(aa,{className:"grid w-full grid-cols-2",children:[e.jsxs(we,{value:"configured",className:"gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Configured Tables",e.jsx(_,{variant:"secondary",className:"ml-2",children:a.tables?.length||0})]}),e.jsxs(we,{value:"available",className:"gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Available Tables",e.jsx(_,{variant:"secondary",className:"ml-2",children:o.length})]})]}),e.jsx(Ce,{value:"configured",className:"space-y-6",children:e.jsxs(J,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(je,{children:"Configured Tables"}),e.jsx(be,{children:"Tables that have been configured for use in the application"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Search tables...",value:T,onChange:s=>H(s.target.value),className:"pl-9"})]})})]})}),e.jsx(ee,{children:xe.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(ks,{children:[e.jsx(Ts,{children:e.jsxs(ge,{children:[e.jsx($,{children:"Display Name"}),e.jsx($,{children:"Table Name"}),e.jsx($,{children:"Primary Key"}),e.jsx($,{children:"Fields"}),e.jsx($,{children:"Status"}),e.jsx($,{className:"text-right",children:"Actions"})]})}),e.jsx(Ss,{children:xe.map(s=>e.jsxs(ge,{children:[e.jsx(M,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-blue-600"}),s.name]})}),e.jsx(M,{children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:s.table_name})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{children:s.primary_key})]})}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.fields.slice(0,3).map(l=>e.jsx(_,{variant:"secondary",className:"text-xs",children:l},l)),s.fields.length>3&&e.jsxs(_,{variant:"outline",className:"text-xs",children:["+",s.fields.length-3," more"]})]})}),e.jsx(M,{children:e.jsx(_,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{size:"sm",variant:"outline",onClick:()=>ue(s),children:e.jsx(As,{className:"w-3 h-3"})}),e.jsx(C,{size:"sm",asChild:!0,children:e.jsx(K,{href:`/product?conn=${a.id}&table=${s.id}`,children:e.jsx(Ms,{className:"w-3 h-3"})})}),e.jsxs(fs,{children:[e.jsx(js,{asChild:!0,children:e.jsx(C,{size:"sm",variant:"destructive",children:e.jsx(bs,{className:"w-3 h-3"})})}),e.jsxs(gs,{children:[e.jsxs(ys,{children:[e.jsx(vs,{children:"Delete Table Configuration"}),e.jsx(Ns,{children:"This will delete the table configuration but won't affect the actual database table."})]}),e.jsxs(ws,{children:[e.jsx(Cs,{children:"Cancel"}),e.jsx(_s,{onClick:()=>s.id&&We(s.id),className:"bg-red-600",children:"Delete"})]})]})]})]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(U,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No tables configured"}),e.jsxs(C,{onClick:()=>m(!0),className:"gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Add Your First Table"]})]})})]})}),e.jsx(Ce,{value:"available",children:e.jsxs(J,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(je,{children:"Available Database Tables"}),e.jsx(be,{children:"All tables found in the database"})]}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(B,{placeholder:"Search tables...",value:T,onChange:s=>H(s.target.value),className:"pl-9"})]})})]})}),e.jsx(ee,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:he.filter(s=>s&&s.trim()!=="").map(s=>{const l=a.tables?.some(n=>n.table_name===s),r=a.tables?.find(n=>n.table_name===s);return e.jsx(J,{children:e.jsxs(ee,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded ${l?"bg-green-100":"bg-gray-100"}`,children:e.jsx(V,{className:`w-5 h-5 ${l?"text-green-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s}),r&&e.jsx("p",{className:"text-sm text-gray-600",children:r.name})]})]}),l?e.jsxs(_,{variant:"outline",className:"bg-green-50 text-green-700",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Configured"]}):e.jsx(_,{variant:"outline",children:"Available"})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>r&&ue(r),children:"Edit"}),e.jsx(C,{size:"sm",className:"flex-1",asChild:!0,children:e.jsx(K,{href:`/product?conn=${a.id}&table=${r?.id}`,children:"View"})})]}):e.jsx(C,{size:"sm",className:"flex-1",onClick:()=>{u(s),m(!0),N(null)},children:"Configure"})})]})},s)})})})]})})]})})]})})}export{$a as default};
